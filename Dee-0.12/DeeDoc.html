<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.5: http://docutils.sourceforge.net/" />
<title>Dee</title>
<meta name="author" content="Greg Gaughan" />
<meta name="copyright" content="Copyright (C) 2007 Greg Gaughan" />
<meta name="date" content="22/05/2007" />
<style type="text/css">

/*
:Author: David Goodger
:Contact: goodger@users.sourceforge.net
:Date: $Date: 2005-12-18 01:56:14 +0100 (Sun, 18 Dec 2005) $
:Revision: $Revision: 4224 $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin-left: 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left {
  clear: left }

img.align-right {
  clear: right }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font-family: serif ;
  font-size: 100% }

pre.literal-block, pre.doctest-block {
  margin-left: 2em ;
  margin-right: 2em ;
  background-color: #eeeeee }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

tt.docutils {
  background-color: #eeeeee }

ul.auto-toc {
  list-style-type: none }


.highlight { background: #f8f8f8; margin-left: 2em ; margin-right: 2em}
.highlight .c { color: #008800; font-style: italic } /* Comment */
.highlight .err { border: 1px solid #FF0000 } /* Error */
.highlight .k { color: #AA22FF; font-weight: bold } /* Keyword */
.highlight .o { color: #666666 } /* Operator */
.highlight .cm { color: #008800; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #008800 } /* Comment.Preproc */
.highlight .c1 { color: #008800; font-style: italic } /* Comment.Single */
.highlight .cs { color: #008800; font-weight: bold } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #808080 } /* Generic.Output */
.highlight .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0040D0 } /* Generic.Traceback */
.highlight .kc { color: #AA22FF; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #AA22FF; font-weight: bold } /* Keyword.Declaration */
.highlight .kp { color: #AA22FF } /* Keyword.Pseudo */
.highlight .kr { color: #AA22FF; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #AA22FF; font-weight: bold } /* Keyword.Type */
.highlight .m { color: #666666 } /* Literal.Number */
.highlight .s { color: #BB4444 } /* Literal.String */
.highlight .na { color: #BB4444 } /* Name.Attribute */
.highlight .nb { color: #AA22FF } /* Name.Builtin */
.highlight .nc { color: #0000FF } /* Name.Class */
.highlight .no { color: #880000 } /* Name.Constant */
.highlight .nd { color: #AA22FF } /* Name.Decorator */
.highlight .ni { color: #999999; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #00A000 } /* Name.Function */
.highlight .nl { color: #A0A000 } /* Name.Label */
.highlight .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #008000; font-weight: bold } /* Name.Tag */
.highlight .nv { color: #B8860B } /* Name.Variable */
.highlight .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.highlight .mf { color: #666666 } /* Literal.Number.Float */
.highlight .mh { color: #666666 } /* Literal.Number.Hex */
.highlight .mi { color: #666666 } /* Literal.Number.Integer */
.highlight .mo { color: #666666 } /* Literal.Number.Oct */
.highlight .sb { color: #BB4444 } /* Literal.String.Backtick */
.highlight .sc { color: #BB4444 } /* Literal.String.Char */
.highlight .sd { color: #BB4444; font-style: italic } /* Literal.String.Doc */
.highlight .s2 { color: #BB4444 } /* Literal.String.Double */
.highlight .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.highlight .sh { color: #BB4444 } /* Literal.String.Heredoc */
.highlight .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.highlight .sx { color: #008000 } /* Literal.String.Other */
.highlight .sr { color: #BB6688 } /* Literal.String.Regex */
.highlight .s1 { color: #BB4444 } /* Literal.String.Single */
.highlight .ss { color: #B8860B } /* Literal.String.Symbol */
.highlight .bp { color: #AA22FF } /* Name.Builtin.Pseudo */
.highlight .vc { color: #B8860B } /* Name.Variable.Class */
.highlight .vg { color: #B8860B } /* Name.Variable.Global */
.highlight .vi { color: #B8860B } /* Name.Variable.Instance */
.highlight .il { color: #666666 } /* Literal.Number.Integer.Long */

</style>
</head>
<body>
<div class="document" id="dee">
<h1 class="title"><a class="reference external" href="http://www.quicksort.co.uk">Dee</a></h1>
<h2 class="subtitle" id="makes-python-relational">makes <a class="reference external" href="http://www.python.org/">Python</a> relational</h2>
<table class="docinfo" frame="void" rules="none">
<col class="docinfo-name" />
<col class="docinfo-content" />
<tbody valign="top">
<tr><th class="docinfo-name">Author:</th>
<td>Greg Gaughan</td></tr>
<tr><th class="docinfo-name">Copyright:</th>
<td>Copyright (C) 2007 Greg Gaughan</td></tr>
<tr class="field"><th class="docinfo-name">Licence:</th><td class="field-body">GPL (see Licence.txt for details)</td>
</tr>
<tr><th class="docinfo-name">Contact:</th>
<td><a class="first last reference external" href="mailto:feedback&#37;&#52;&#48;quicksort&#46;co&#46;uk">feedback<span>&#64;</span>quicksort<span>&#46;</span>co<span>&#46;</span>uk</a></td></tr>
<tr><th class="docinfo-name">Date:</th>
<td>22/05/2007</td></tr>
</tbody>
</table>
<!-- todo:

update css
        style sheet! (same as web?)

add .. sidebar:: Sidebar Title
        :subtitle: Optional Sidebar Subtitle

add image(s)! -->
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id5">Introduction</a></li>
<li><a class="reference internal" href="#mind-the-gap" id="id6">Mind the Gap</a></li>
<li><a class="reference internal" href="#enough-of-the-shenanigans" id="id7">Enough of the Shenanigans!</a></li>
<li><a class="reference internal" href="#a-bit-of-history" id="id8">A Bit of History</a></li>
<li><a class="reference internal" href="#where-we-re-coming-from" id="id9">Where We're Coming From</a></li>
<li><a class="reference internal" href="#where-we-re-going" id="id10">Where We're Going</a></li>
<li><a class="reference internal" href="#basics" id="id11">Basics</a><ul>
<li><a class="reference internal" href="#tuples" id="id12">Tuples</a></li>
<li><a class="reference internal" href="#relations" id="id13">Relations</a><ul>
<li><a class="reference internal" href="#the-interpretation-of-a-relation" id="id14">The Interpretation of a Relation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#function-based-relations" id="id15">Function-based Relations</a></li>
<li><a class="reference internal" href="#relation-valued-attributes" id="id16">Relation-Valued Attributes</a></li>
<li><a class="reference internal" href="#predefined-relations" id="id17">Predefined Relations</a><ul>
<li><a class="reference internal" href="#dum" id="id18">DUM</a></li>
<li><a class="reference internal" href="#id3" id="id19">DEE</a></li>
</ul>
</li>
<li><a class="reference internal" href="#relation-constraints" id="id20">Relation Constraints</a></li>
</ul>
</li>
<li><a class="reference internal" href="#lambda" id="id21">Lambda</a></li>
<li><a class="reference internal" href="#relations-to-tuples" id="id22">Relations to Tuples</a><ul>
<li><a class="reference internal" href="#fromtuple" id="id23">fromTuple</a></li>
<li><a class="reference internal" href="#totuple" id="id24">toTuple</a></li>
<li><a class="reference internal" href="#fromtuplelist" id="id25">fromTupleList</a></li>
<li><a class="reference internal" href="#totuplelist" id="id26">toTupleList</a></li>
</ul>
</li>
<li><a class="reference internal" href="#relational-comparisons" id="id27">Relational Comparisons</a><ul>
<li><a class="reference internal" href="#equality" id="id28">Equality (==)</a></li>
<li><a class="reference internal" href="#inequality-not" id="id29">Inequality (!=, not ... ==)</a></li>
<li><a class="reference internal" href="#proper-subset" id="id30">Proper Subset (&lt;)</a></li>
<li><a class="reference internal" href="#subset" id="id31">Subset (&lt;=)</a></li>
<li><a class="reference internal" href="#proper-superset" id="id32">Proper Superset (&gt;)</a></li>
<li><a class="reference internal" href="#superset" id="id33">Superset (&gt;=)</a></li>
<li><a class="reference internal" href="#membership-in" id="id34">Membership (in)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#relational-operators" id="id35">Relational Operators</a><ul>
<li><a class="reference internal" href="#projection-project-remove" id="id36">Projection (project, remove)</a></li>
<li><a class="reference internal" href="#rename-rename" id="id37">Rename (rename)</a></li>
<li><a class="reference internal" href="#restriction-where" id="id38">Restriction (where)</a></li>
<li><a class="reference internal" href="#natural-join-times-intersection" id="id39">Natural Join, Times, Intersection (&amp;)</a><ul>
<li><a class="reference internal" href="#natural-join-some-attributes-in-common" id="id40">Natural Join - Some attributes in common</a></li>
<li><a class="reference internal" href="#times-cartesian-join-no-attributes-in-common" id="id41">Times (Cartesian Join) - No attributes in common</a></li>
<li><a class="reference internal" href="#intersection-all-attributes-in-common" id="id42">Intersection - All attributes in common</a></li>
</ul>
</li>
<li><a class="reference internal" href="#or-union" id="id43">Or, Union (|)</a></li>
<li><a class="reference internal" href="#difference" id="id44">Difference (-)</a></li>
<li><a class="reference internal" href="#extension-extend" id="id45">Extension (extend)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#aggregate-operators" id="id46">Aggregate Operators</a><ul>
<li><a class="reference internal" href="#count-len" id="id47">COUNT (len)</a></li>
<li><a class="reference internal" href="#sum" id="id48">SUM</a></li>
<li><a class="reference internal" href="#avg" id="id49">AVG</a></li>
<li><a class="reference internal" href="#min" id="id50">MIN</a></li>
<li><a class="reference internal" href="#max" id="id51">MAX</a></li>
<li><a class="reference internal" href="#all" id="id52">ALL</a></li>
<li><a class="reference internal" href="#any" id="id53">ANY</a></li>
<li><a class="reference internal" href="#is-empty" id="id54">IS_EMPTY</a></li>
</ul>
</li>
<li><a class="reference internal" href="#some-not-so-basic-but-very-useful-operators" id="id55">Some Not-so-basic but Very Useful Operators</a><ul>
<li><a class="reference internal" href="#generation-generate" id="id56">Generation (GENERATE)</a></li>
<li><a class="reference internal" href="#divide-divide-simple" id="id57">Divide (DIVIDE_SIMPLE)</a></li>
<li><a class="reference internal" href="#summarization-summarize" id="id58">Summarization (SUMMARIZE)</a></li>
<li><a class="reference internal" href="#grouping-and-ungrouping-group-ungroup" id="id59">Grouping and Ungrouping (GROUP, UNGROUP)</a></li>
<li><a class="reference internal" href="#wrapping-and-unwrapping-wrap-unwrap" id="id60">Wrapping and Unwrapping (WRAP, UNWRAP)</a></li>
<li><a class="reference internal" href="#semijoin-semijoin-matching" id="id61">Semijoin (SEMIJOIN, MATCHING)</a></li>
<li><a class="reference internal" href="#semidifference-semiminus-not-matching" id="id62">Semidifference (SEMIMINUS, NOT_MATCHING)</a></li>
<li><a class="reference internal" href="#composition-compose" id="id63">Composition (COMPOSE)</a></li>
<li><a class="reference internal" href="#transitive-closure-tclose" id="id64">Transitive Closure (TCLOSE)</a></li>
<li><a class="reference internal" href="#quota-quota" id="id65">Quota (QUOTA)</a></li>
<li><a class="reference internal" href="#insert-insert" id="id66">Insert (insert, |=)</a></li>
<li><a class="reference internal" href="#delete-delete" id="id67">Delete (delete, -=)</a></li>
<li><a class="reference internal" href="#update-update" id="id68">Update (update)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#user-definable-operators" id="id69">User-definable Operators</a></li>
<li><a class="reference internal" href="#databases" id="id70">Databases</a></li>
<li><a class="reference internal" href="#clusters" id="id71">Clusters</a></li>
<li><a class="reference internal" href="#transactions" id="id72">Transactions</a></li>
<li><a class="reference internal" href="#front-ends" id="id73">Front-ends</a></li>
<li><a class="reference internal" href="#future-work" id="id74">Future Work</a><ul>
<li><a class="reference internal" href="#constraint-checking" id="id75">Constraint Checking</a></li>
<li><a class="reference internal" href="#constraint-inference" id="id76">Constraint Inference</a></li>
<li><a class="reference internal" href="#catalog-maintenance" id="id77">Catalog Maintenance</a></li>
<li><a class="reference internal" href="#storage" id="id78">Storage</a></li>
<li><a class="reference internal" href="#concurrency" id="id79">Concurrency</a></li>
<li><a class="reference internal" href="#attribute-values" id="id80">Attribute Values</a></li>
<li><a class="reference internal" href="#api" id="id81">API</a></li>
<li><a class="reference internal" href="#virtual-relation-variables" id="id82">Virtual Relation Variables</a></li>
<li><a class="reference internal" href="#security" id="id83">Security</a></li>
<li><a class="reference internal" href="#sql-veneer" id="id84">SQL Veneer</a></li>
<li><a class="reference internal" href="#optimisation" id="id85">Optimisation</a></li>
<li><a class="reference internal" href="#surface-more-abstractions" id="id86">Surface More Abstractions</a></li>
<li><a class="reference internal" href="#et-cetera" id="id87">Et Cetera</a></li>
</ul>
</li>
<li><a class="reference internal" href="#colophon" id="id88">Colophon</a></li>
</ul>
</div>
<div class="section" id="introduction">
<h1><a class="toc-backref" href="#id5">Introduction</a></h1>
<p>Inspired by Date and Darwen's <a class="reference external" href="http://www.amazon.co.uk/Databases-Types-Relational-Model-C-J/dp/0321399420/sr=1-2/qid=1169757255/ref=sr_1_2/203-3128636-8071105?ie=UTF8&amp;s=books">Databases, Types and the Relational Model (The Third Manifesto)</a>, we're putting forward an implementation of a truly relational language using <a class="reference external" href="http://www.python.org/">Python</a>. We will address two problems:</p>
<blockquote>
<ol class="arabic simple">
<li>The impedance mismatch between programming languages and databases</li>
<li>The weakness and syntactic awkwardness of SQL</li>
</ol>
</blockquote>
</div>
<div class="section" id="mind-the-gap">
<h1><a class="toc-backref" href="#id6">Mind the Gap</a></h1>
<p>Most of today's programs handle data in one way or another and often this data is stored in some kind of relational database. To read and modify this data, a program must bridge the gap between its representation and the one used by the dialect of SQL that the database provides. This bridge typically comprises a database API that sends queries as text strings, often accompanied by some kind of table-to-object mapper that has to coerce data and relationships in both directions, usually with elaborate layers of abstraction in an effort to keep the two sides loosely coupled.</p>
<blockquote>
<p>&quot;Yet by obscuring the true data source these solutions end up throwing away the most compelling feature of relational databases; the ability for the data to be queried.&quot;</p>
<p class="attribution">&mdash;Microsoft, DLinq .NET Language-Integrated Query for Relational Data, May 2006</p>
</blockquote>
<div class="sidebar">
<p class="first sidebar-title">&quot;It was Codd's very great insight that a database could be thought of as a set of relations, that a relation in turn could be thought of as a set of propositions (assumed by convention to be true), and hence that all of the apparatus of formal logic could be directly applied to the problem of database access and related problems.&quot;</p>
<p class="last">-- C. J. Date, <a class="reference external" href="http://www.amazon.co.uk/Database-Relational-Model-Retrospective-Historical/dp/0201612941/sr=1-9/qid=1169757016/ref=sr_1_9/203-3128636-8071105?ie=UTF8&amp;s=books">The Database Relational Model</a>, Addison-Wesley, April 2000</p>
</div>
<p>This approach not only adds complexity and increases the need for data transformations but, most importantly, it destroys the significant advantages provided by the relational model of data. The relational model is built upon predicate logic which brings the power of formal reasoning to data: it is the only sound foundation available.</p>
</div>
<div class="section" id="enough-of-the-shenanigans">
<h1><a class="toc-backref" href="#id7">Enough of the Shenanigans!</a></h1>
<p>A number of approaches and frameworks have been proposed to span the gap between the two systems; most never question why there are two systems in the first place.</p>
<p>Microsoft's forthcoming LINQ to SQL (formerly DLinq) is a major attempt to bring SQL closer into the program than before, but will still keep the database sub-language and all that it entails.</p>
<blockquote>
<p>&quot;It is no wonder that applications expected to bridge this gap are difficult to build and maintain. It would certainly simplify the equation to get rid of one side or the other. Yet relational databases provide critical infrastructure for long-term storage and query processing, and modern programming languages are indispensable for agile development and rich computation.&quot;</p>
<p class="attribution">&mdash;Microsoft, DLinq .NET Language-Integrated Query for Relational Data, May 2006</p>
</blockquote>
<p>The solution to the problem is not to get rid of one side or the other, nor to have one side overlap the other, but to merge the two sides into one: supersede SQL (the COBOL of database languages) with a true relational programming language, one that is computationally complete, and then the gap disappears. Our solution uses one of the most effective, expressive and readable languages available, <a class="reference external" href="http://www.python.org/">Python</a>, and extends it with relations and a sound relational algebra.</p>
</div>
<div class="section" id="a-bit-of-history">
<h1><a class="toc-backref" href="#id8">A Bit of History</a></h1>
<p>Since its inception in 1969 by E. F. Codd, the relational model has been the foundation for nearly all databases. It replaced earlier network and hierarchical ad-hoc approaches to data storage by being as simple as it needed to be, but no simpler. It was so powerful it allowed users to ask for what they wanted to find, rather than specify how they might find it.</p>
<p>Over the decades, SQL has become the de-facto language for relational databases, but SQL misses many of the benefits of relational technology. In recent years, partly due to SQL's weaknesses and partly due to minimalistic and stagnant implementations, the database has become merely a storage engine fronted by layers of drivers, mappers, hierarchical markups and frameworks which make flexible querying both complex and distant from the application code.</p>
</div>
<div class="section" id="where-we-re-coming-from">
<h1><a class="toc-backref" href="#id9">Where We're Coming From</a></h1>
<p>Having implemented a comprehensive, standards-compliant SQL server, <a class="reference external" href="http://www.thinksql.co.uk">ThinkSQL</a>, we did some further research into the history of SQL's dominance in the marketplace and its quirky syntax. We found a far superior alternative in the form of <strong>D</strong> <a class="footnote-reference" href="#id4" id="id2">[1]</a>, a generic name for any relational language that conforms to <a class="reference external" href="http://www.amazon.co.uk/Databases-Types-Relational-Model-C-J/dp/0321399420/sr=1-2/qid=1169757255/ref=sr_1_2/203-3128636-8071105?ie=UTF8&amp;s=books">The Third Manifesto</a>. We’ve implemented such a language, <a class="reference external" href="http://www.quicksort.co.uk">Dee</a>, as an extension to <a class="reference external" href="http://www.python.org/">Python</a>.</p>
<p>The relational algebra and most of the ideas underlying <a class="reference external" href="http://www.quicksort.co.uk">Dee</a> come from Date and Darwen's <a class="reference external" href="http://www.amazon.co.uk/Databases-Types-Relational-Model-C-J/dp/0321399420/sr=1-2/qid=1169757255/ref=sr_1_2/203-3128636-8071105?ie=UTF8&amp;s=books">Databases, Types and the Relational Model (The Third Manifesto)</a>. An introduction into the ideas behind it can be found in <a class="reference external" href="http://www.amazon.co.uk/Database-Depth-Relational-Model-Practitioners/dp/0596100124/sr=1-2/qid=1169757016/ref=sr_1_2/203-3128636-8071105?ie=UTF8&amp;s=books">Databases in Depth</a> and many related links and reference materials are on <a class="reference external" href="http://www.thethirdmanifesto.com">The Third Manifesto website</a>.</p>
<p>The current version of <a class="reference external" href="http://www.quicksort.co.uk">Dee</a> is an initial release to gain feedback regarding the approach. We chose <a class="reference external" href="http://www.python.org/">Python</a> because its interpreted style, dynamic typing and built-in sets and dictionaries make it ideal for interacting with data; plus any language that allows you to do the following sorts of things has got to be good:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">90</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
<span class="go">45 90</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span>         <span class="c">#swapping values without the usual temporary variable!</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
<span class="go">90 45</span>

<span class="gp">&gt;&gt;&gt; </span><span class="mi">70</span> <span class="o">&lt;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">120</span>
<span class="go">True</span>
</pre></div>
<p>See <a class="reference external" href="http://www.python.org/doc/essays/ppt/acm-ws/sld011.htm">Why Use Python?</a> for more information on the advantages of the language. A guide to the Python language can be found in <a class="reference external" href="http://www.network-theory.co.uk/python/intro/">An Introduction to Python</a>. We do assume you are familiar with Python in what follows.</p>
</div>
<div class="section" id="where-we-re-going">
<h1><a class="toc-backref" href="#id10">Where We're Going</a></h1>
<p>The current release is an initial proposal, intended to encourage feedback. We have many ideas for future versions to make it more deployable. See the <a class="reference internal" href="#future-work">Future Work</a> section below for more details.</p>
</div>
<div class="section" id="basics">
<h1><a class="toc-backref" href="#id11">Basics</a></h1>
<p>To start using <a class="reference external" href="http://www.quicksort.co.uk">Dee</a> from within the <a class="reference external" href="http://www.python.org/">Python</a> interpreter or from a <a class="reference external" href="http://www.python.org/">Python</a> program, first import the module. (For demonstrating we import everything but it's recommended that you only import the features you need.)</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">from</span> <span class="nn">Dee</span> <span class="k">import</span> <span class="o">*</span>
</pre></div>
<div class="section" id="tuples">
<h2><a class="toc-backref" href="#id12">Tuples</a></h2>
<p>A Tuple is a set of attribute/value pairs. A Tuple can be represented by a <a class="reference external" href="http://www.python.org/">Python</a> dictionary, e.g.</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="p">{</span><span class="s">&quot;StudentId&quot;</span><span class="p">:</span><span class="s">&#39;S1&#39;</span><span class="p">,</span> <span class="s">&quot;Name&quot;</span><span class="p">:</span><span class="s">&#39;Anne&#39;</span><span class="p">}</span>
<span class="go">{&#39;StudentId&#39;: &#39;S1&#39;, &#39;Name&#39;: &#39;Anne&#39;}</span>
</pre></div>
<p>and the attributes and values can be extracted using the standard <a class="reference external" href="http://www.python.org/">Python</a> syntax, e.g.</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t1</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;StudentId&quot;</span><span class="p">:</span><span class="s">&#39;S1&#39;</span><span class="p">,</span> <span class="s">&quot;Name&quot;</span><span class="p">:</span><span class="s">&#39;Anne&#39;</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t1</span><span class="p">[</span><span class="s">&quot;StudentId&quot;</span><span class="p">]</span>
<span class="go">&#39;S1&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="s">&quot;Name&quot;</span> <span class="ow">in</span> <span class="n">t1</span>
<span class="go">True</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">t1</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="go">[&#39;StudentId&#39;, &#39;Name&#39;]</span>
</pre></div>
<p>A more powerful way is to use the Tuple class which allows a slightly simpler syntax for denoting attribute values. To specify a Tuple:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t1</span> <span class="o">=</span> <span class="n">Tuple</span><span class="p">(</span><span class="n">StudentId</span><span class="o">=</span><span class="s">&#39;S1&#39;</span><span class="p">,</span> <span class="n">Name</span><span class="o">=</span><span class="s">&#39;Anne&#39;</span><span class="p">)</span>
</pre></div>
<p>and then the attributes values can be extracted in the same way as the <a class="reference external" href="http://www.python.org/">Python</a> dictionary but also using the dot notation without the quotes, e.g.</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t1</span><span class="p">[</span><span class="s">&quot;Name&quot;</span><span class="p">]</span>
<span class="go">&#39;Anne&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">t1</span><span class="o">.</span><span class="n">Name</span>
<span class="go">&#39;Anne&#39;</span>
</pre></div>
<p>The Tuple class also provides a number of useful methods, such as project and remove, for manipulating relational tuples.</p>
<p>Attribute values are dynamically typed in the usual <a class="reference external" href="http://www.python.org/">Python</a> way and they must be of the same type for every tuple in a given relation. Currently, the types can be anything that can be <a class="reference external" href="http://docs.python.org/lib/module-pickle.html">pickled</a>.</p>
</div>
<div class="section" id="relations">
<h2><a class="toc-backref" href="#id13">Relations</a></h2>
<p>A Relation comprises a heading and a body. The heading is a set of attribute name/type pairs. The body is a set of tuples. Each tuple in the body comprises a value for every attribute in the heading. To specify a relation literal, pass the heading as a list of attribute names followed by the body as a list of tuple literals, e.g.:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">Relation</span><span class="p">([</span><span class="s">&quot;StudentId&quot;</span><span class="p">,</span> <span class="s">&quot;Name&quot;</span><span class="p">],</span>
<span class="gp">... </span>              <span class="p">[{</span><span class="s">&quot;StudentId&quot;</span><span class="p">:</span><span class="s">&#39;S1&#39;</span><span class="p">,</span> <span class="s">&quot;Name&quot;</span><span class="p">:</span><span class="s">&#39;Anne&#39;</span><span class="p">},</span>
<span class="gp">... </span>               <span class="p">{</span><span class="s">&quot;StudentId&quot;</span><span class="p">:</span><span class="s">&#39;S2&#39;</span><span class="p">,</span> <span class="s">&quot;Name&quot;</span><span class="p">:</span><span class="s">&#39;Boris&#39;</span><span class="p">},</span>
<span class="gp">... </span>               <span class="p">{</span><span class="s">&quot;StudentId&quot;</span><span class="p">:</span><span class="s">&#39;S3&#39;</span><span class="p">,</span> <span class="s">&quot;Name&quot;</span><span class="p">:</span><span class="s">&#39;Cindy&#39;</span><span class="p">},</span>
<span class="gp">... </span>               <span class="p">{</span><span class="s">&quot;StudentId&quot;</span><span class="p">:</span><span class="s">&#39;S4&#39;</span><span class="p">,</span> <span class="s">&quot;Name&quot;</span><span class="p">:</span><span class="s">&#39;Devinder&#39;</span><span class="p">},</span>
<span class="gp">... </span>               <span class="p">{</span><span class="s">&quot;StudentId&quot;</span><span class="p">:</span><span class="s">&#39;S5&#39;</span><span class="p">,</span> <span class="s">&quot;Name&quot;</span><span class="p">:</span><span class="s">&#39;Boris&#39;</span><span class="p">},</span>
<span class="gp">... </span>              <span class="p">])</span>
<span class="go">+-----------+----------+</span>
<span class="go">| StudentId | Name     |</span>
<span class="go">+===========+==========+</span>
<span class="go">| S1        | Anne     |</span>
<span class="go">| S2        | Boris    |</span>
<span class="go">| S3        | Cindy    |</span>
<span class="go">| S4        | Devinder |</span>
<span class="go">| S5        | Boris    |</span>
<span class="go">+-----------+----------+</span>
</pre></div>
<p>Note:</p>
<ul class="simple">
<li>there is no order to the heading attributes (they are a set)</li>
<li>nor is there any order to the tuples in the body (they are a set)</li>
<li>there is no duplication in the heading attribute names (they are a set)</li>
<li>nor is there any duplication in the tuples in the body (they are a set)</li>
</ul>
<p>Also, we will try to use the term <strong>relation variable</strong> when we mean a variable that refers to a Relation, and just <strong>relation</strong> (or relation value) to mean the value of the relation. This is an important distinction. The value of a relation never changes, just like the value 5 never changes.</p>
<p>To assign a relation value to a relation variable, use the standard <a class="reference external" href="http://www.python.org/">Python</a> syntax, e.g.</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">IS_CALLED</span> <span class="o">=</span> <span class="n">Relation</span><span class="p">([</span><span class="s">&quot;StudentId&quot;</span><span class="p">,</span> <span class="s">&quot;Name&quot;</span><span class="p">],</span>
<span class="gp">... </span>                    <span class="p">[{</span><span class="s">&quot;StudentId&quot;</span><span class="p">:</span><span class="s">&#39;S1&#39;</span><span class="p">,</span> <span class="s">&quot;Name&quot;</span><span class="p">:</span><span class="s">&#39;Anne&#39;</span><span class="p">},</span>
<span class="gp">... </span>                     <span class="p">{</span><span class="s">&quot;StudentId&quot;</span><span class="p">:</span><span class="s">&#39;S2&#39;</span><span class="p">,</span> <span class="s">&quot;Name&quot;</span><span class="p">:</span><span class="s">&#39;Boris&#39;</span><span class="p">},</span>
<span class="gp">... </span>                     <span class="p">{</span><span class="s">&quot;StudentId&quot;</span><span class="p">:</span><span class="s">&#39;S3&#39;</span><span class="p">,</span> <span class="s">&quot;Name&quot;</span><span class="p">:</span><span class="s">&#39;Cindy&#39;</span><span class="p">},</span>
<span class="gp">... </span>                     <span class="p">{</span><span class="s">&quot;StudentId&quot;</span><span class="p">:</span><span class="s">&#39;S4&#39;</span><span class="p">,</span> <span class="s">&quot;Name&quot;</span><span class="p">:</span><span class="s">&#39;Devinder&#39;</span><span class="p">},</span>
<span class="gp">... </span>                     <span class="p">{</span><span class="s">&quot;StudentId&quot;</span><span class="p">:</span><span class="s">&#39;S5&#39;</span><span class="p">,</span> <span class="s">&quot;Name&quot;</span><span class="p">:</span><span class="s">&#39;Boris&#39;</span><span class="p">},</span>
<span class="gp">... </span>                    <span class="p">])</span>
</pre></div>
<p>An alternative way to define a relation is to use the Tuple class to define the body:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">IS_CALLED</span> <span class="o">=</span> <span class="n">Relation</span><span class="p">([</span><span class="s">&quot;StudentId&quot;</span><span class="p">,</span> <span class="s">&quot;Name&quot;</span><span class="p">],</span>
<span class="gp">... </span>                    <span class="p">[</span><span class="n">Tuple</span><span class="p">(</span><span class="n">StudentId</span><span class="o">=</span><span class="s">&#39;S1&#39;</span><span class="p">,</span> <span class="n">Name</span><span class="o">=</span><span class="s">&#39;Anne&#39;</span><span class="p">),</span>
<span class="gp">... </span>                     <span class="n">Tuple</span><span class="p">(</span><span class="n">StudentId</span><span class="o">=</span><span class="s">&#39;S2&#39;</span><span class="p">,</span> <span class="n">Name</span><span class="o">=</span><span class="s">&#39;Boris&#39;</span><span class="p">),</span>
<span class="gp">... </span>                     <span class="n">Tuple</span><span class="p">(</span><span class="n">StudentId</span><span class="o">=</span><span class="s">&#39;S3&#39;</span><span class="p">,</span> <span class="n">Name</span><span class="o">=</span><span class="s">&#39;Cindy&#39;</span><span class="p">),</span>
<span class="gp">... </span>                     <span class="n">Tuple</span><span class="p">(</span><span class="n">StudentId</span><span class="o">=</span><span class="s">&#39;S4&#39;</span><span class="p">,</span> <span class="n">Name</span><span class="o">=</span><span class="s">&#39;Devinder&#39;</span><span class="p">),</span>
<span class="gp">... </span>                     <span class="n">Tuple</span><span class="p">(</span><span class="n">StudentId</span><span class="o">=</span><span class="s">&#39;S5&#39;</span><span class="p">,</span> <span class="n">Name</span><span class="o">=</span><span class="s">&#39;Boris&#39;</span><span class="p">),</span>
<span class="gp">... </span>                    <span class="p">])</span>
</pre></div>
<p>or alteratively, a more concise option is available which relies on the order of the body attributes matching the order of the heading:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">IS_CALLED</span> <span class="o">=</span> <span class="n">Relation</span><span class="p">([</span><span class="s">&quot;StudentId&quot;</span><span class="p">,</span> <span class="s">&quot;Name&quot;</span><span class="p">],</span>
<span class="gp">... </span>                    <span class="p">[(</span><span class="s">&#39;S1&#39;</span><span class="p">,</span> <span class="s">&#39;Anne&#39;</span><span class="p">),</span>
<span class="gp">... </span>                     <span class="p">(</span><span class="s">&#39;S2&#39;</span><span class="p">,</span> <span class="s">&#39;Boris&#39;</span><span class="p">),</span>
<span class="gp">... </span>                     <span class="p">(</span><span class="s">&#39;S3&#39;</span><span class="p">,</span> <span class="s">&#39;Cindy&#39;</span><span class="p">),</span>
<span class="gp">... </span>                     <span class="p">(</span><span class="s">&#39;S4&#39;</span><span class="p">,</span> <span class="s">&#39;Devinder&#39;</span><span class="p">),</span>
<span class="gp">... </span>                     <span class="p">(</span><span class="s">&#39;S5&#39;</span><span class="p">,</span> <span class="s">&#39;Boris&#39;</span><span class="p">),</span>
<span class="gp">... </span>                    <span class="p">])</span>
</pre></div>
<p>(Note that <a class="reference external" href="http://www.python.org/">Python</a> allows an additional comma after the last item in a list, which can simplify copy/paste operations. Also a <a class="reference external" href="http://www.python.org/">Python</a> tuple with a single value must have a comma after the value to distinguish it from a value in parentheses, e.g. <tt class="docutils literal"><span class="pre">(7,)</span></tt> rather than <tt class="docutils literal"><span class="pre">(7)</span></tt>)</p>
<p>There are a number of ways to display a relation:</p>
<ol class="arabic simple">
<li>Print it as a string (i.e. using its <tt class="docutils literal"><span class="pre">__str__</span></tt> method), e.g.</li>
</ol>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_CALLED</span>
<span class="go">+-----------+----------+</span>
<span class="go">| StudentId | Name     |</span>
<span class="go">+===========+==========+</span>
<span class="go">| S1        | Anne     |</span>
<span class="go">| S2        | Boris    |</span>
<span class="go">| S3        | Cindy    |</span>
<span class="go">| S4        | Devinder |</span>
<span class="go">| S5        | Boris    |</span>
<span class="go">+-----------+----------+</span>
</pre></div>
<ol class="arabic simple" start="2">
<li>Print a literal representation (one of possibly many variations) (i.e. using its <tt class="docutils literal"><span class="pre">__repr__</span></tt> method), e.g.</li>
</ol>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="sb">`IS_CALLED`</span>           <span class="c">#or just: &gt;&gt;&gt; IS_CALLED</span>
<span class="go">Relation((&#39;StudentId&#39;, &#39;Name&#39;),</span>
<span class="go">[Tuple(StudentId=&#39;S1&#39;, Name=&#39;Anne&#39;), Tuple(StudentId=&#39;S2&#39;, Name=&#39;Boris&#39;), Tuple(StudentId=&#39;S3&#39;, Name=&#39;Cindy&#39;), Tuple(StudentId=&#39;S4&#39;, Name=&#39;Devinder&#39;), Tuple(StudentId=&#39;S5&#39;, Name=&#39;Boris&#39;)],</span>
<span class="go">{&#39;PK&#39;:(Key, None)})</span>
</pre></div>
<p>Note: this literal can itself be evaluated using <a class="reference external" href="http://www.python.org/">Python</a>'s <tt class="docutils literal"><span class="pre">eval()</span></tt> function to retrieve the relation's value, e.g.</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="nb">eval</span><span class="p">(</span><span class="sb">`IS_CALLED`</span><span class="p">)</span>
<span class="go">+-----------+----------+</span>
<span class="go">| StudentId | Name     |</span>
<span class="go">+===========+==========+</span>
<span class="go">| S1        | Anne     |</span>
<span class="go">| S2        | Boris    |</span>
<span class="go">| S3        | Cindy    |</span>
<span class="go">| S4        | Devinder |</span>
<span class="go">| S5        | Boris    |</span>
<span class="go">+-----------+----------+</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r2</span><span class="o">=</span><span class="nb">eval</span><span class="p">(</span><span class="sb">`IS_CALLED`</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">r2</span>
<span class="go">+-----------+----------+</span>
<span class="go">| StudentId | Name     |</span>
<span class="go">+===========+==========+</span>
<span class="go">| S1        | Anne     |</span>
<span class="go">| S2        | Boris    |</span>
<span class="go">| S3        | Cindy    |</span>
<span class="go">| S4        | Devinder |</span>
<span class="go">| S5        | Boris    |</span>
<span class="go">+-----------+----------+</span>
</pre></div>
<ol class="arabic simple" start="3">
<li>Print it rendered as an HTML table, e.g.</li>
</ol>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_CALLED</span><span class="o">.</span><span class="n">renderHTML</span><span class="p">()</span>
<span class="go">&lt;table&gt;&lt;thead&gt;&lt;th&gt;&lt;em&gt;StudentId&lt;/em&gt;&lt;/th&gt;&lt;th&gt;&lt;em&gt;Name&lt;/em&gt;&lt;/th&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;S1&lt;/td&gt;&lt;td&gt;Anne&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;S2&lt;/td&gt;&lt;td&gt;Boris&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;S3&lt;/td&gt;&lt;td&gt;Cindy&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;S4&lt;/td&gt;&lt;td&gt;Devinder&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;S5&lt;/td&gt;&lt;td&gt;Boris&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;</span>
</pre></div>
<p>Which in a browser becomes:</p>
<blockquote>
<table border="1" class="docutils">
<colgroup>
<col width="52%" />
<col width="48%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">StudentId</th>
<th class="head">Name</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>S1</td>
<td>Anne</td>
</tr>
<tr><td>S2</td>
<td>Boris</td>
</tr>
<tr><td>S3</td>
<td>Cindy</td>
</tr>
<tr><td>S4</td>
<td>Devinder</td>
</tr>
<tr><td>S5</td>
<td>Boris</td>
</tr>
</tbody>
</table>
</blockquote>
<p>The heading of a relation can be retrieved via its <tt class="docutils literal"><span class="pre">heading</span></tt> method, which returns the attribute names as a <a class="reference external" href="http://www.python.org/">Python</a> set, e.g.</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_CALLED</span><span class="o">.</span><span class="n">heading</span><span class="p">()</span>
<span class="go">set([&#39;StudentId&#39;, &#39;Name&#39;])</span>
</pre></div>
<div class="section" id="the-interpretation-of-a-relation">
<h3><a class="toc-backref" href="#id14">The Interpretation of a Relation</a></h3>
<p>Given a relation such as the one denoted by IS_CALLED above, we should take the meaning of it to be as follows:</p>
<ul class="simple">
<li>The heading supplies the parameters for the <strong>predicate</strong>, e.g. StudentId and Name are the parameters for the IS_CALLED predicate.</li>
<li>The tuple <tt class="docutils literal"><span class="pre">Tuple(StudentId='S3',</span> <span class="pre">Name='Cindy')</span></tt> is an <em>instantiation</em> of that predicate. It is a <strong>proposition</strong> where the argument values 'S3' and 'Cindy' are substituted for the parameters. This states that student S3 is called Cindy.</li>
<li>Each tuple in the relation is a <em>true</em> instantiation.</li>
<li>Any tuple not in the relation is a <em>false</em> instantiation.</li>
</ul>
</div>
</div>
<div class="section" id="function-based-relations">
<h2><a class="toc-backref" href="#id15">Function-based Relations</a></h2>
<p>Instead of defining the value of a relation variable once when it is assigned, we can refer to a function to provide the relation. The function can then return different values at different times. One important kind of relation variable that refers to a function for its data is a virtual (or derived) relation variable. A <strong>virtual</strong> relation variable refers to a function that returns a relational expression. All other relational variables are <strong>base</strong> relation variables. To specify a virtual relation variable we first need to define a function to provide the data by returning a relational expression. For example (ignore the relational expression syntax for now, we'll cover the details of that later):</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">vIS_CALLED_caps</span><span class="p">():</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">IS_CALLED</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s">&#39;NameCaps&#39;</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;NameCaps&#39;</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Name</span><span class="o">.</span><span class="n">upper</span><span class="p">()})</span><span class="o">.</span><span class="n">remove</span><span class="p">([</span><span class="s">&#39;Name&#39;</span><span class="p">])</span>
</pre></div>
<p>Then pass the heading as a list of attribute names followed by the body as a function reference, e.g.</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">IS_CALLED_caps</span> <span class="o">=</span> <span class="n">Relation</span><span class="p">([</span><span class="s">&quot;StudentId&quot;</span><span class="p">,</span> <span class="s">&quot;NameCaps&quot;</span><span class="p">],</span> <span class="n">vIS_CALLED_caps</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_CALLED_caps</span>
<span class="go">+-----------+----------+</span>
<span class="go">| StudentId | NameCaps |</span>
<span class="go">+===========+==========+</span>
<span class="go">| S1        | ANNE     |</span>
<span class="go">| S2        | BORIS    |</span>
<span class="go">| S3        | CINDY    |</span>
<span class="go">| S4        | DEVINDER |</span>
<span class="go">| S5        | BORIS    |</span>
<span class="go">+-----------+----------+</span>
</pre></div>
<p>Such virtual relation variables' values will then vary as the underlying base relation variables vary. These virtual relation variables are called views in SQL.</p>
</div>
<div class="section" id="relation-valued-attributes">
<h2><a class="toc-backref" href="#id16">Relation-Valued Attributes</a></h2>
<p>An attribute value can itself be a relation. Such attributes are known as relation-valued attributes or RVAs. There are a number of relational operators (actually macros) that use such nested relations. For example, <tt class="docutils literal"><span class="pre">GROUP</span></tt>, which takes a relation and a set of attribute names together with a new attribute name and returns a relation with the set of attributes as a nested relation, 1 per unique value of the non-grouped attributes:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">GROUP</span><span class="p">(</span><span class="n">IS_CALLED</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;StudentId&#39;</span><span class="p">],</span> <span class="s">&#39;StudentIds&#39;</span><span class="p">)</span>
<span class="go">+----------+---------------+</span>
<span class="go">| Name     | StudentIds    |</span>
<span class="go">+==========+===============+</span>
<span class="go">| Anne     | +-----------+ |</span>
<span class="go">|          | | StudentId | |</span>
<span class="go">|          | +===========+ |</span>
<span class="go">|          | | S1        | |</span>
<span class="go">|          | +-----------+ |</span>
<span class="go">| Boris    | +-----------+ |</span>
<span class="go">|          | | StudentId | |</span>
<span class="go">|          | +===========+ |</span>
<span class="go">|          | | S2        | |</span>
<span class="go">|          | | S5        | |</span>
<span class="go">|          | +-----------+ |</span>
<span class="go">| Cindy    | +-----------+ |</span>
<span class="go">|          | | StudentId | |</span>
<span class="go">|          | +===========+ |</span>
<span class="go">|          | | S3        | |</span>
<span class="go">|          | +-----------+ |</span>
<span class="go">| Devinder | +-----------+ |</span>
<span class="go">|          | | StudentId | |</span>
<span class="go">|          | +===========+ |</span>
<span class="go">|          | | S4        | |</span>
<span class="go">|          | +-----------+ |</span>
<span class="go">+----------+---------------+</span>
</pre></div>
</div>
<div class="section" id="predefined-relations">
<h2><a class="toc-backref" href="#id17">Predefined Relations</a></h2>
<p>There are two interesting relations that are useful for defining some fundamental relational operators in <a class="reference external" href="http://www.quicksort.co.uk">Dee</a>. We introduce them here.</p>
<div class="section" id="dum">
<h3><a class="toc-backref" href="#id18">DUM</a></h3>
<p>This is the relation that has no attributes and no tuples. It plays the role of False. It is difficult to display:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">DUM</span>
<span class="go">+</span>
<span class="go">|</span>
<span class="go">+</span>
<span class="go">+</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">DUM</span><span class="o">.</span><span class="n">renderHTML</span><span class="p">()</span>
<span class="go">&lt;table&gt;&lt;thead&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;/tbody&gt;&lt;/table&gt;</span>
</pre></div>
<p>It is also called TABLE_DUM and FALSE.</p>
</div>
<div class="section" id="id3">
<h3><a class="toc-backref" href="#id19">DEE</a></h3>
<p>This is the relation that has no attributes and a single tuple. It plays the role of True. It is difficult to display:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">DEE</span>
<span class="go">+</span>
<span class="go">|</span>
<span class="go">+</span>
<span class="go">|</span>
<span class="go">+</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">DEE</span><span class="o">.</span><span class="n">renderHTML</span><span class="p">()</span>
<span class="go">&lt;table&gt;&lt;thead&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;</span>
</pre></div>
<p>It is also called TABLE_DEE and TRUE.</p>
</div>
</div>
<div class="section" id="relation-constraints">
<h2><a class="toc-backref" href="#id20">Relation Constraints</a></h2>
<p>A Relation (function-based or not) can also take an extra parameter in its constructor to specify a set of constraints. This takes the form of a <a class="reference external" href="http://www.python.org/">Python</a> dictionary where each key gives the constraint name and each value is a pair of constraint-function, parameters. For example, to specify that the &quot;StudentId&quot; attribute is a candidate key for the above relation we could say:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">IS_CALLED</span> <span class="o">=</span> <span class="n">Relation</span><span class="p">([</span><span class="s">&quot;StudentId&quot;</span><span class="p">,</span> <span class="s">&quot;Name&quot;</span><span class="p">],</span>
<span class="gp">... </span>                    <span class="p">[(</span><span class="s">&#39;S1&#39;</span><span class="p">,</span> <span class="s">&#39;Anne&#39;</span><span class="p">),</span>
<span class="gp">... </span>                     <span class="p">(</span><span class="s">&#39;S2&#39;</span><span class="p">,</span> <span class="s">&#39;Boris&#39;</span><span class="p">),</span>
<span class="gp">... </span>                     <span class="p">(</span><span class="s">&#39;S3&#39;</span><span class="p">,</span> <span class="s">&#39;Cindy&#39;</span><span class="p">),</span>
<span class="gp">... </span>                     <span class="p">(</span><span class="s">&#39;S4&#39;</span><span class="p">,</span> <span class="s">&#39;Devinder&#39;</span><span class="p">),</span>
<span class="gp">... </span>                     <span class="p">(</span><span class="s">&#39;S5&#39;</span><span class="p">,</span> <span class="s">&#39;Boris&#39;</span><span class="p">),</span>
<span class="gp">... </span>                    <span class="p">],</span>
<span class="gp">... </span>                    <span class="p">{</span><span class="s">&#39;PK&#39;</span><span class="p">:(</span><span class="n">Key</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;StudentId&quot;</span><span class="p">])}</span>
<span class="gp">... </span>                   <span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_CALLED</span>
<span class="go">+-----------+----------+</span>
<span class="go">| StudentId | Name     |</span>
<span class="go">+===========+----------+</span>
<span class="go">| S1        | Anne     |</span>
<span class="go">| S2        | Boris    |</span>
<span class="go">| S3        | Cindy    |</span>
<span class="go">| S4        | Devinder |</span>
<span class="go">| S5        | Boris    |</span>
<span class="go">+-----------+----------+</span>
</pre></div>
<p>Here, <tt class="docutils literal"><span class="pre">Key</span></tt> is a pre-defined constraint type (actually a function wrapper that creates a function) that takes a list of attributes to enforce the constraint. A constraint function can return True or False and is called whenever the relation is assigned a new value. If no candidate key is specified for a relation, one is assumed comprising all the attributes in the relation (this is displayed in representations as <tt class="docutils literal"><span class="pre">{'PK':(Key,</span> <span class="pre">None)}</span></tt>). As another example:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">COURSE</span> <span class="o">=</span> <span class="n">Relation</span><span class="p">([</span><span class="s">&quot;CourseId&quot;</span><span class="p">,</span> <span class="s">&quot;Title&quot;</span><span class="p">],</span>
<span class="gp">... </span>                 <span class="p">[(</span><span class="s">&#39;C1&#39;</span><span class="p">,</span> <span class="s">&#39;Database&#39;</span><span class="p">),</span>
<span class="gp">... </span>                  <span class="p">(</span><span class="s">&#39;C2&#39;</span><span class="p">,</span> <span class="s">&#39;HCI&#39;</span><span class="p">),</span>
<span class="gp">... </span>                  <span class="p">(</span><span class="s">&#39;C3&#39;</span><span class="p">,</span> <span class="s">&#39;Op Systems&#39;</span><span class="p">),</span>
<span class="gp">... </span>                  <span class="p">(</span><span class="s">&#39;C4&#39;</span><span class="p">,</span> <span class="s">&#39;Programming&#39;</span><span class="p">),</span>
<span class="gp">... </span>                 <span class="p">],</span>
<span class="gp">... </span>                 <span class="p">{</span><span class="s">&#39;PK&#39;</span><span class="p">:(</span><span class="n">Key</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;CourseId&quot;</span><span class="p">])}</span>
<span class="gp">... </span>                <span class="p">)</span>
</pre></div>
<p>Another pre-defined constraint (function wrapper) is <tt class="docutils literal"><span class="pre">ForeignKey</span></tt>. It takes a relation name and a mapping of foreign key attributes to candidate key attributes as parameters, e.g.:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">IS_ENROLLED_ON</span> <span class="o">=</span> <span class="n">Relation</span><span class="p">([</span><span class="s">&quot;StudentId&quot;</span><span class="p">,</span> <span class="s">&quot;CourseId&quot;</span><span class="p">],</span>
<span class="gp">... </span>                        <span class="p">[(</span><span class="s">&#39;S1&#39;</span><span class="p">,</span> <span class="s">&#39;C1&#39;</span><span class="p">),</span>
<span class="gp">... </span>                         <span class="p">(</span><span class="s">&#39;S1&#39;</span><span class="p">,</span> <span class="s">&#39;C2&#39;</span><span class="p">),</span>
<span class="gp">... </span>                         <span class="p">(</span><span class="s">&#39;S2&#39;</span><span class="p">,</span> <span class="s">&#39;C1&#39;</span><span class="p">),</span>
<span class="gp">... </span>                         <span class="p">(</span><span class="s">&#39;S3&#39;</span><span class="p">,</span> <span class="s">&#39;C3&#39;</span><span class="p">),</span>
<span class="gp">... </span>                         <span class="p">(</span><span class="s">&#39;S4&#39;</span><span class="p">,</span> <span class="s">&#39;C1&#39;</span><span class="p">),</span>
<span class="gp">... </span>                        <span class="p">],</span>
<span class="gp">... </span>                        <span class="p">{</span><span class="s">&#39;FKS&#39;</span><span class="p">:(</span><span class="n">ForeignKey</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;IS_CALLED&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&quot;StudentId&quot;</span><span class="p">:</span><span class="s">&quot;StudentId&quot;</span><span class="p">})),</span>
<span class="gp">... </span>                         <span class="s">&#39;FKC&#39;</span><span class="p">:(</span><span class="n">ForeignKey</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;COURSE&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&quot;CourseId&quot;</span><span class="p">:</span><span class="s">&quot;CourseId&quot;</span><span class="p">}))}</span>
<span class="gp">... </span>                       <span class="p">)</span>
</pre></div>
<p>Here, two foreign keys are declared to ensure referential integrity between this relation and the relations referred to by IS_CALLED and COURSE.</p>
</div>
</div>
<div class="section" id="lambda">
<h1><a class="toc-backref" href="#id21">Lambda</a></h1>
<p>In a number of places we need to pass expressions, e.g. restrictions (where clauses). <a class="reference external" href="http://www.python.org/">Python</a> has a built-in way of defining such expressions with anonymous functions using the <tt class="docutils literal"><span class="pre">lambda</span></tt> keyword. So an example restriction for the above IS_CALLED relation could be:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_CALLED</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Name</span> <span class="o">==</span> <span class="s">&#39;Boris&#39;</span><span class="p">)</span>
<span class="go">+-----------+-------+</span>
<span class="go">| StudentId | Name  |</span>
<span class="go">+===========+=======+</span>
<span class="go">| S2        | Boris |</span>
<span class="go">| S5        | Boris |</span>
<span class="go">+-----------+-------+</span>
</pre></div>
<p>In this example, the lambda expression is passed to the relation's <tt class="docutils literal"><span class="pre">where</span></tt> function and the expression introduces a range variable, <tt class="docutils literal"><span class="pre">t</span></tt>, which will stand for each Tuple in the relation. The expression itself, the part after the colon, tests whether the Name attribute of each tuple is equal to 'Boris': if it is then the tuple is included in the result. Any <a class="reference external" href="http://www.python.org/">Python</a> expression can be passed this way. So here, complex boolean expressions including boolean operators and function calls can be built, e.g.</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_CALLED</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;B&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">t</span><span class="o">.</span><span class="n">StudentId</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;5&#39;</span><span class="p">))</span>
<span class="go">+-----------+-------+</span>
<span class="go">| StudentId | Name  |</span>
<span class="go">+===========+=======+</span>
<span class="go">| S5        | Boris |</span>
<span class="go">+-----------+-------+</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_CALLED</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="s">&#39;A&#39;</span> <span class="o">&lt;</span> <span class="n">t</span><span class="o">.</span><span class="n">Name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="s">&#39;D&#39;</span><span class="p">)</span>
<span class="go">+-----------+-------+</span>
<span class="go">| StudentId | Name  |</span>
<span class="go">+===========+=======+</span>
<span class="go">| S2        | Boris |</span>
<span class="go">| S3        | Cindy |</span>
<span class="go">| S5        | Boris |</span>
<span class="go">+-----------+-------+</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_CALLED</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="p">[</span><span class="s">&quot;Name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;B&#39;</span><span class="p">))</span>
<span class="go">+-----------+-------+</span>
<span class="go">| StudentId | Name  |</span>
<span class="go">+===========+=======+</span>
<span class="go">| S2        | Boris |</span>
<span class="go">| S5        | Boris |</span>
<span class="go">+-----------+-------+</span>
</pre></div>
<p>Of course, simple boolean expressions can also be used, e.g.</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_CALLED</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="bp">True</span><span class="p">)</span>
<span class="go">+-----------+----------+</span>
<span class="go">| StudentId | Name     |</span>
<span class="go">+===========+==========+</span>
<span class="go">| S1        | Anne     |</span>
<span class="go">| S2        | Boris    |</span>
<span class="go">| S3        | Cindy    |</span>
<span class="go">| S4        | Devinder |</span>
<span class="go">| S5        | Boris    |</span>
<span class="go">+-----------+----------+</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_CALLED</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="bp">False</span><span class="p">)</span>
<span class="go">+-----------+------+</span>
<span class="go">| StudentId | Name |</span>
<span class="go">+===========+======+</span>
<span class="go">+-----------+------+</span>
</pre></div>
<p>It's perhaps worth noting that the where function is really just shorthand for a natural join. Take the first example:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_CALLED</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Name</span> <span class="o">==</span> <span class="s">&#39;Boris&#39;</span><span class="p">)</span>
<span class="go">+-----------+-------+</span>
<span class="go">| StudentId | Name  |</span>
<span class="go">+===========+=======+</span>
<span class="go">| S2        | Boris |</span>
<span class="go">| S5        | Boris |</span>
<span class="go">+-----------+-------+</span>
</pre></div>
<p>This relational calculus based where clause can be rephrased using the relational algebra's <tt class="docutils literal"><span class="pre">AND</span></tt> operator (in this case acting as the natural join):</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_CALLED</span> <span class="o">&amp;</span> <span class="n">Relation</span><span class="p">([</span><span class="s">&quot;Name&quot;</span><span class="p">],</span> <span class="p">[(</span><span class="s">&#39;Boris&#39;</span><span class="p">,)])</span>
<span class="go">+-----------+-------+</span>
<span class="go">| StudentId | Name  |</span>
<span class="go">+===========+=======+</span>
<span class="go">| S2        | Boris |</span>
<span class="go">| S5        | Boris |</span>
<span class="go">+-----------+-------+</span>
</pre></div>
<p>Many of the relational methods provided are in fact macros implemented using only a few fundamental relational operators, such as <tt class="docutils literal"><span class="pre">AND</span></tt>.</p>
<p>Another place lambda expressions can be used is when defining virtual relation variables. For example the earlier example:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">vIS_CALLED_caps</span><span class="p">():</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">IS_CALLED</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s">&#39;NameCaps&#39;</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;NameCaps&#39;</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Name</span><span class="o">.</span><span class="n">upper</span><span class="p">()})</span><span class="o">.</span><span class="n">remove</span><span class="p">([</span><span class="s">&#39;Name&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">IS_CALLED_caps</span> <span class="o">=</span> <span class="n">Relation</span><span class="p">([</span><span class="s">&quot;StudentId&quot;</span><span class="p">,</span> <span class="s">&quot;NameCaps&quot;</span><span class="p">],</span> <span class="n">vIS_CALLED_caps</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_CALLED_caps</span>
<span class="go">+-----------+----------+</span>
<span class="go">| StudentId | NameCaps |</span>
<span class="go">+===========+==========+</span>
<span class="go">| S1        | ANNE     |</span>
<span class="go">| S2        | BORIS    |</span>
<span class="go">| S3        | CINDY    |</span>
<span class="go">| S4        | DEVINDER |</span>
<span class="go">| S5        | BORIS    |</span>
<span class="go">+-----------+----------+</span>
</pre></div>
<p>Could be re-coded using lambda in a more concise way as:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">IS_CALLED_caps</span> <span class="o">=</span> <span class="n">Relation</span><span class="p">([</span><span class="s">&quot;StudentId&quot;</span><span class="p">,</span> <span class="s">&quot;NameCaps&quot;</span><span class="p">],</span>
<span class="gp">... </span>                           <span class="k">lambda</span><span class="p">:</span> <span class="n">IS_CALLED</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s">&quot;NameCaps&quot;</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="p">{</span>
<span class="gp">... </span>                                                     <span class="s">&quot;NameCaps&quot;</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Name</span><span class="o">.</span><span class="n">upper</span><span class="p">()})</span><span class="o">.</span><span class="n">remove</span><span class="p">([</span><span class="s">&quot;Name&quot;</span><span class="p">]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_CALLED_caps</span>
<span class="go">+-----------+----------+</span>
<span class="go">| StudentId | NameCaps |</span>
<span class="go">+===========+==========+</span>
<span class="go">| S1        | ANNE     |</span>
<span class="go">| S2        | BORIS    |</span>
<span class="go">| S3        | CINDY    |</span>
<span class="go">| S4        | DEVINDER |</span>
<span class="go">| S5        | BORIS    |</span>
<span class="go">+-----------+----------+</span>
</pre></div>
<p>Lambda expressions can also be used as general constraints. On relations, another pre-defined constraint is <tt class="docutils literal"><span class="pre">Constraint</span></tt>. This takes a function that must evaluate to True for the constraint to hold, e.g.:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">EXAM_MARK</span> <span class="o">=</span> <span class="n">Relation</span><span class="p">([</span><span class="s">&quot;StudentId&quot;</span><span class="p">,</span> <span class="s">&quot;CourseId&quot;</span><span class="p">,</span> <span class="s">&quot;Mark&quot;</span><span class="p">],</span>
<span class="gp">... </span>                    <span class="p">[(</span><span class="s">&#39;S1&#39;</span><span class="p">,</span> <span class="s">&#39;C1&#39;</span><span class="p">,</span> <span class="mi">85</span><span class="p">),</span>
<span class="gp">... </span>                     <span class="p">(</span><span class="s">&#39;S1&#39;</span><span class="p">,</span> <span class="s">&#39;C2&#39;</span><span class="p">,</span> <span class="mi">49</span><span class="p">),</span>
<span class="gp">... </span>                     <span class="p">(</span><span class="s">&#39;S2&#39;</span><span class="p">,</span> <span class="s">&#39;C1&#39;</span><span class="p">,</span> <span class="mi">49</span><span class="p">),</span>
<span class="gp">... </span>                     <span class="p">(</span><span class="s">&#39;S3&#39;</span><span class="p">,</span> <span class="s">&#39;C3&#39;</span><span class="p">,</span> <span class="mi">66</span><span class="p">),</span>
<span class="gp">... </span>                     <span class="p">(</span><span class="s">&#39;S4&#39;</span><span class="p">,</span> <span class="s">&#39;C1&#39;</span><span class="p">,</span> <span class="mi">93</span><span class="p">),</span>
<span class="gp">... </span>                    <span class="p">],</span>
<span class="gp">... </span>                    <span class="p">{</span><span class="s">&#39;PK&#39;</span><span class="p">:(</span><span class="n">Key</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;StudentId&quot;</span><span class="p">,</span> <span class="s">&quot;CourseId&quot;</span><span class="p">]),</span>
<span class="gp">... </span>                     <span class="s">&#39;MarkRange&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">Constraint</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">ALL</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">t</span><span class="o">.</span><span class="n">Mark</span> <span class="o">&lt;=</span> <span class="mi">100</span><span class="p">))}</span>
<span class="gp">... </span>                   <span class="p">)</span>
</pre></div>
<p>Here, the 'MarkRange' Constraint uses the <tt class="docutils literal"><span class="pre">ALL</span></tt> relational operator (discussed below) to ensure that all Marks in this relation are between 0 and 100. Note the Constraint works at the relation level and its range variable is <tt class="docutils literal"><span class="pre">r</span></tt> in the example. Useful operators at this level are <tt class="docutils literal"><span class="pre">ALL</span></tt>, <tt class="docutils literal"><span class="pre">ANY</span></tt>, <tt class="docutils literal"><span class="pre">IS_EMPTY</span></tt>, and the relational comparison operators discussed below, because they all take relations and return a boolean result.</p>
</div>
<div class="section" id="relations-to-tuples">
<h1><a class="toc-backref" href="#id22">Relations to Tuples</a></h1>
<p>Here are some conversion functions to map between relations and tuples:</p>
<div class="section" id="fromtuple">
<h2><a class="toc-backref" href="#id23">fromTuple</a></h2>
<p>This static method returns a relation from a tuple:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">r1</span> <span class="o">=</span> <span class="n">Relation</span><span class="o">.</span><span class="n">fromTuple</span><span class="p">({</span><span class="s">&#39;CourseId&#39;</span><span class="p">:</span><span class="s">&#39;C1&#39;</span><span class="p">,</span> <span class="s">&#39;Title&#39;</span><span class="p">:</span><span class="s">&#39;Database&#39;</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">r1</span>
<span class="go">+----------+----------+</span>
<span class="go">| CourseId | Title    |</span>
<span class="go">+==========+==========+</span>
<span class="go">| C1       | Database |</span>
<span class="go">+----------+----------+</span>
</pre></div>
<p>It can also take an extra parameter to specify a set of constraints:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">r1</span> <span class="o">=</span> <span class="n">Relation</span><span class="o">.</span><span class="n">fromTuple</span><span class="p">({</span><span class="s">&#39;CourseId&#39;</span><span class="p">:</span><span class="s">&#39;C1&#39;</span><span class="p">,</span> <span class="s">&#39;Title&#39;</span><span class="p">:</span><span class="s">&#39;Database&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s">&#39;PK&#39;</span><span class="p">:(</span><span class="n">Key</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;CourseId&#39;</span><span class="p">])})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">r1</span>
<span class="go">+----------+----------+</span>
<span class="go">| CourseId | Title    |</span>
<span class="go">+==========+----------+</span>
<span class="go">| C1       | Database |</span>
<span class="go">+----------+----------+</span>
</pre></div>
</div>
<div class="section" id="totuple">
<h2><a class="toc-backref" href="#id24">toTuple</a></h2>
<p>This can apply only to a single-tuple relation and returns a tuple from that relation:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t1</span> <span class="o">=</span> <span class="n">r1</span><span class="o">.</span><span class="n">toTuple</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">t1</span>
<span class="go">Tuple(CourseId=&#39;C1&#39;, Title=&#39;Database&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">t1</span><span class="o">.</span><span class="n">Title</span>
<span class="go">Database</span>
</pre></div>
</div>
<div class="section" id="fromtuplelist">
<h2><a class="toc-backref" href="#id25">fromTupleList</a></h2>
<p>This static method returns a relation from a list of tuples:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">r2</span> <span class="o">=</span> <span class="n">Relation</span><span class="o">.</span><span class="n">fromTupleList</span><span class="p">([{</span><span class="s">&#39;CourseId&#39;</span><span class="p">:</span><span class="s">&#39;C1&#39;</span><span class="p">,</span> <span class="s">&#39;Title&#39;</span><span class="p">:</span><span class="s">&#39;Database&#39;</span><span class="p">},</span>
<span class="gp">... </span>                             <span class="p">{</span><span class="s">&#39;CourseId&#39;</span><span class="p">:</span><span class="s">&#39;C4&#39;</span><span class="p">,</span> <span class="s">&#39;Title&#39;</span><span class="p">:</span><span class="s">&#39;Programming&#39;</span><span class="p">},</span>
<span class="gp">... </span>                             <span class="p">{</span><span class="s">&#39;CourseId&#39;</span><span class="p">:</span><span class="s">&#39;C3&#39;</span><span class="p">,</span> <span class="s">&#39;Title&#39;</span><span class="p">:</span><span class="s">&#39;Op Systems&#39;</span><span class="p">},</span>
<span class="gp">... </span>                             <span class="p">{</span><span class="s">&#39;CourseId&#39;</span><span class="p">:</span><span class="s">&#39;C2&#39;</span><span class="p">,</span> <span class="s">&#39;Title&#39;</span><span class="p">:</span><span class="s">&#39;HCI&#39;</span><span class="p">}])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">r2</span>
<span class="go">+----------+-------------+</span>
<span class="go">| CourseId | Title       |</span>
<span class="go">+==========+=============+</span>
<span class="go">| C1       | Database    |</span>
<span class="go">| C4       | Programming |</span>
<span class="go">| C3       | Op Systems  |</span>
<span class="go">| C2       | HCI         |</span>
<span class="go">+----------+-------------+</span>
</pre></div>
<p>It can also take an extra parameter to specify a set of constraints:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">r2</span> <span class="o">=</span> <span class="n">Relation</span><span class="o">.</span><span class="n">fromTupleList</span><span class="p">([{</span><span class="s">&#39;CourseId&#39;</span><span class="p">:</span><span class="s">&#39;C1&#39;</span><span class="p">,</span> <span class="s">&#39;Title&#39;</span><span class="p">:</span><span class="s">&#39;Database&#39;</span><span class="p">},</span>
<span class="gp">... </span>                             <span class="p">{</span><span class="s">&#39;CourseId&#39;</span><span class="p">:</span><span class="s">&#39;C4&#39;</span><span class="p">,</span> <span class="s">&#39;Title&#39;</span><span class="p">:</span><span class="s">&#39;Programming&#39;</span><span class="p">},</span>
<span class="gp">... </span>                             <span class="p">{</span><span class="s">&#39;CourseId&#39;</span><span class="p">:</span><span class="s">&#39;C3&#39;</span><span class="p">,</span> <span class="s">&#39;Title&#39;</span><span class="p">:</span><span class="s">&#39;Op Systems&#39;</span><span class="p">},</span>
<span class="gp">... </span>                             <span class="p">{</span><span class="s">&#39;CourseId&#39;</span><span class="p">:</span><span class="s">&#39;C2&#39;</span><span class="p">,</span> <span class="s">&#39;Title&#39;</span><span class="p">:</span><span class="s">&#39;HCI&#39;</span><span class="p">}],</span>
<span class="gp">... </span>                            <span class="p">{</span><span class="s">&#39;PK&#39;</span><span class="p">:(</span><span class="n">Key</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;CourseId&#39;</span><span class="p">])})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">r2</span>
<span class="go">+----------+-------------+</span>
<span class="go">| CourseId | Title       |</span>
<span class="go">+==========+-------------+</span>
<span class="go">| C1       | Database    |</span>
<span class="go">| C4       | Programming |</span>
<span class="go">| C3       | Op Systems  |</span>
<span class="go">| C2       | HCI         |</span>
<span class="go">+----------+-------------+</span>
</pre></div>
</div>
<div class="section" id="totuplelist">
<h2><a class="toc-backref" href="#id26">toTupleList</a></h2>
<p>This returns a list of tuples from the relation. Since relations are sets they can have no order, so to iterate through all the tuples in a relation you must use this method to first extract a list of tuples from the relation.</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ts</span> <span class="o">=</span> <span class="n">r2</span><span class="o">.</span><span class="n">toTupleList</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">ts</span>
<span class="go">[Tuple(CourseId=&#39;C1&#39;, Title=&#39;Database&#39;), Tuple(CourseId=&#39;C4&#39;, Title=&#39;Programming&#39;), Tuple(CourseId=&#39;C3&#39;, Title=&#39;Op Systems&#39;), Tuple(CourseId=&#39;C2&#39;, Title=&#39;HCI&#39;)]</span>
</pre></div>
<p>This list can then be iterated over in the usual ways, e.g:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">ts</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">t</span><span class="o">.</span><span class="n">Title</span>
<span class="go">Database</span>
<span class="go">Programming</span>
<span class="go">Op Systems</span>
<span class="go">HCI</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">Title</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">ts</span> <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">CourseId</span><span class="o">==</span><span class="s">&#39;C4&#39;</span><span class="p">]</span>
<span class="go">[&#39;Programming&#39;]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">reversed</span><span class="p">(</span><span class="n">ts</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">t</span><span class="o">.</span><span class="n">Title</span>
<span class="go">HCI</span>
<span class="go">Op Systems</span>
<span class="go">Programming</span>
<span class="go">Database</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="nb">len</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>
<span class="go">4</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">ts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">Tuple(CourseId=&#39;C1&#39;, Title=&#39;Database&#39;)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">ts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="go">Tuple(CourseId=&#39;C2&#39;, Title=&#39;HCI&#39;)</span>
</pre></div>
<p>This is also the way to access the tuples in a pre-defined order. The <tt class="docutils literal"><span class="pre">toTupleList</span></tt> method can take an extra parameter to define a sort order. The sort parameter is a pair <tt class="docutils literal"><span class="pre">(ascending,</span> <span class="pre">attribute-list)</span></tt> where <tt class="docutils literal"><span class="pre">ascending</span></tt> is a boolean flag to indicate whether to sort in ascending order or not, and the <tt class="docutils literal"><span class="pre">attribute-list</span></tt> specifies the attributes to sort on.</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">tss</span> <span class="o">=</span> <span class="n">r2</span><span class="o">.</span><span class="n">toTupleList</span><span class="p">((</span><span class="bp">True</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;Title&#39;</span><span class="p">]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">Title</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tss</span><span class="p">]</span>
<span class="go">[&#39;Database&#39;, &#39;HCI&#39;, &#39;Op Systems&#39;, &#39;Programming&#39;]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">tss</span> <span class="o">=</span> <span class="n">r2</span><span class="o">.</span><span class="n">toTupleList</span><span class="p">((</span><span class="bp">False</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;CourseId&#39;</span><span class="p">]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">CourseId</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tss</span><span class="p">]</span>
<span class="go">[&#39;C4&#39;, &#39;C3&#39;, &#39;C2&#39;, &#39;C1&#39;]</span>
</pre></div>
<p>The <tt class="docutils literal"><span class="pre">renderToHTML</span></tt> method, mentioned earlier, is built upon the <tt class="docutils literal"><span class="pre">toTupleList</span></tt> method and also allows this sort parameter, e.g:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">r2</span><span class="o">.</span><span class="n">renderHTML</span><span class="p">(</span><span class="n">sort</span><span class="o">=</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;Title&#39;</span><span class="p">]))</span>
<span class="go">&lt;table&gt;&lt;thead&gt;&lt;th&gt;&lt;em&gt;CourseId&lt;/em&gt;&lt;/th&gt;&lt;th&gt;Title&lt;/th&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;C1&lt;/td&gt;&lt;td&gt;Database&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;C2&lt;/td&gt;&lt;td&gt;HCI&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;C3&lt;/td&gt;&lt;td&gt;Op Systems&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;C4&lt;/td&gt;&lt;td&gt;Programming&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;</span>
</pre></div>
<p>Which in a browser becomes:</p>
<blockquote>
<table border="1" class="docutils">
<colgroup>
<col width="43%" />
<col width="57%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">CourseId</th>
<th class="head">Title</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>C1</td>
<td>Database</td>
</tr>
<tr><td>C2</td>
<td>HCI</td>
</tr>
<tr><td>C3</td>
<td>Op Systems</td>
</tr>
<tr><td>C4</td>
<td>Programming</td>
</tr>
</tbody>
</table>
</blockquote>
</div>
</div>
<div class="section" id="relational-comparisons">
<h1><a class="toc-backref" href="#id27">Relational Comparisons</a></h1>
<p>A number of boolean operators are available to compare the values of two relations. These are all implemented with the obvious overloaded <a class="reference external" href="http://www.python.org/">Python</a> comparisons.</p>
<div class="section" id="equality">
<h2><a class="toc-backref" href="#id28">Equality (==)</a></h2>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_CALLED</span> <span class="o">==</span> <span class="n">Relation</span><span class="p">([</span><span class="s">&quot;StudentId&quot;</span><span class="p">,</span> <span class="s">&quot;Name&quot;</span><span class="p">],</span>
<span class="gp">... </span>                    <span class="p">[(</span><span class="s">&#39;S1&#39;</span><span class="p">,</span> <span class="s">&#39;Anne&#39;</span><span class="p">),</span>
<span class="gp">... </span>                     <span class="p">(</span><span class="s">&#39;S2&#39;</span><span class="p">,</span> <span class="s">&#39;Boris&#39;</span><span class="p">),</span>
<span class="gp">... </span>                     <span class="p">(</span><span class="s">&#39;S3&#39;</span><span class="p">,</span> <span class="s">&#39;Cindy&#39;</span><span class="p">),</span>
<span class="gp">... </span>                     <span class="p">(</span><span class="s">&#39;S4&#39;</span><span class="p">,</span> <span class="s">&#39;Devinder&#39;</span><span class="p">),</span>
<span class="gp">... </span>                     <span class="p">(</span><span class="s">&#39;S5&#39;</span><span class="p">,</span> <span class="s">&#39;Boris&#39;</span><span class="p">),</span>
<span class="gp">... </span>                    <span class="p">])</span>
<span class="go">True</span>
</pre></div>
<p>A useful shorthand for testing equality against an empty relation is to use the <tt class="docutils literal"><span class="pre">IS_EMPTY</span></tt> function:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_EMPTY</span><span class="p">(</span><span class="n">IS_CALLED</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">StudentId</span><span class="o">==</span><span class="s">&#39;S99&#39;</span><span class="p">))</span>
<span class="go">True</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="ow">not</span> <span class="n">IS_EMPTY</span><span class="p">(</span><span class="n">IS_CALLED</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
<div class="section" id="inequality-not">
<h2><a class="toc-backref" href="#id29">Inequality (!=, not ... ==)</a></h2>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_CALLED</span> <span class="o">!=</span> <span class="n">COURSE</span>
<span class="go">True</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="ow">not</span> <span class="n">IS_CALLED</span> <span class="o">==</span> <span class="n">COURSE</span>
<span class="go">True</span>
</pre></div>
</div>
<div class="section" id="proper-subset">
<h2><a class="toc-backref" href="#id30">Proper Subset (&lt;)</a></h2>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_CALLED</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">StudentId</span><span class="o">==</span><span class="s">&#39;S3&#39;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">IS_CALLED</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_CALLED</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">StudentId</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;S&#39;</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">IS_CALLED</span>
<span class="go">False</span>
</pre></div>
</div>
<div class="section" id="subset">
<h2><a class="toc-backref" href="#id31">Subset (&lt;=)</a></h2>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_CALLED</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">StudentId</span><span class="o">==</span><span class="s">&#39;S3&#39;</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">IS_CALLED</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_CALLED</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">StudentId</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;S&#39;</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="n">IS_CALLED</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_CALLED</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">StudentId</span><span class="o">==</span><span class="s">&#39;S3&#39;</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">IS_CALLED</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">StudentId</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;S&#39;</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="n">IS_CALLED</span>
<span class="go">True</span>
</pre></div>
</div>
<div class="section" id="proper-superset">
<h2><a class="toc-backref" href="#id32">Proper Superset (&gt;)</a></h2>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_CALLED</span> <span class="o">&gt;</span> <span class="n">IS_CALLED</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">StudentId</span><span class="o">==</span><span class="s">&#39;S3&#39;</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_CALLED</span> <span class="o">&gt;</span> <span class="n">IS_CALLED</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">StudentId</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;S&#39;</span><span class="p">))</span>
<span class="go">False</span>
</pre></div>
</div>
<div class="section" id="superset">
<h2><a class="toc-backref" href="#id33">Superset (&gt;=)</a></h2>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_CALLED</span> <span class="o">&gt;=</span> <span class="n">IS_CALLED</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">StudentId</span><span class="o">==</span><span class="s">&#39;S3&#39;</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_CALLED</span> <span class="o">&gt;=</span> <span class="n">IS_CALLED</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">StudentId</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;S&#39;</span><span class="p">))</span>
<span class="go">True</span>
</pre></div>
</div>
<div class="section" id="membership-in">
<h2><a class="toc-backref" href="#id34">Membership (in)</a></h2>
<p>This is effectively the same as the subset comparison:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_CALLED</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">StudentId</span><span class="o">==</span><span class="s">&#39;S3&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">IS_CALLED</span>
<span class="go">True</span>
</pre></div>
<p>The membership operator can also be passed a tuple:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">Tuple</span><span class="p">(</span><span class="n">StudentId</span><span class="o">=</span><span class="s">&#39;S3&#39;</span><span class="p">,</span> <span class="n">Name</span><span class="o">=</span><span class="s">&#39;Cindy&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">IS_CALLED</span>
<span class="go">True</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">Tuple</span><span class="p">(</span><span class="n">StudentId</span><span class="o">=</span><span class="s">&#39;S3&#39;</span><span class="p">,</span> <span class="n">Name</span><span class="o">=</span><span class="s">&#39;Bob&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">IS_CALLED</span>
<span class="go">False</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">Tuple</span><span class="p">(</span><span class="n">StudentId</span><span class="o">=</span><span class="s">&#39;S3&#39;</span><span class="p">,</span> <span class="n">Name</span><span class="o">=</span><span class="s">&#39;Cindy&#39;</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">IS_CALLED</span>
<span class="go">False</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">Tuple</span><span class="p">(</span><span class="n">StudentId</span><span class="o">=</span><span class="s">&#39;S3&#39;</span><span class="p">,</span> <span class="n">Name</span><span class="o">=</span><span class="s">&#39;Bob&#39;</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">IS_CALLED</span>
<span class="go">True</span>
</pre></div>
</div>
</div>
<div class="section" id="relational-operators">
<h1><a class="toc-backref" href="#id35">Relational Operators</a></h1>
<p>We use a small core of relational operators to deliver a large number of operations. For example, we use <tt class="docutils literal"><span class="pre">&amp;</span></tt> (relational AND) to provide natural join, intersection and Cartesian product, and we use it as the basis for implementing restriction and extension. A number of other operators are defined as macros on top of the core ones, e.g. <tt class="docutils literal"><span class="pre">GROUP</span></tt>, and this number can easily be increased. The ideas behind this approach can be found in <a class="reference external" href="http://www.amazon.co.uk/Databases-Types-Relational-Model-C-J/dp/0321399420/sr=1-2/qid=1169757255/ref=sr_1_2/203-3128636-8071105?ie=UTF8&amp;s=books">The Third Manifesto</a> chapter 5.</p>
<p>One of the powerful uses of <tt class="docutils literal"><span class="pre">&amp;</span></tt> is the natural join. This joins relations together on their commonly named attributes. To make the most of this, without having to rename attributes before each join, use the same name for the same attributes across relations, e.g. if a key on one relation is named &quot;product_code&quot; then use that same name in all other relations in case they need to be joined. Naming it &quot;code&quot; on the product relation and &quot;product_code&quot; on other relations would require the rename operator to be used before doing a natural join (not to mention making the two attributes appear to be different things).</p>
<p>The relational operators are defined as <a class="reference external" href="http://www.python.org/">Python</a> functions taking, and usually returning, relations. Many of the common ones are also defined as methods and operators on the Relation class.</p>
<p>Some basic operations on a relation now presented.</p>
<div class="section" id="projection-project-remove">
<h2><a class="toc-backref" href="#id36">Projection (project, remove)</a></h2>
<p>This is so called because a relation can be thought of as representing a point in n-dimensional space (where n is the number of attributes) and just selecting a few of them is akin to projecting that point onto the chosen axes.
Note once again that since a relation body is a set of tuples, there are no duplicate tuples.</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_CALLED</span><span class="o">.</span><span class="n">project</span><span class="p">([</span><span class="s">&#39;Name&#39;</span><span class="p">])</span>
<span class="go">+----------+</span>
<span class="go">| Name     |</span>
<span class="go">+==========+</span>
<span class="go">| Anne     |</span>
<span class="go">| Boris    |</span>
<span class="go">| Cindy    |</span>
<span class="go">| Devinder |</span>
<span class="go">+----------+</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_CALLED</span><span class="p">([</span><span class="s">&#39;Name&#39;</span><span class="p">])</span>
<span class="go">+----------+</span>
<span class="go">| Name     |</span>
<span class="go">+==========+</span>
<span class="go">| Anne     |</span>
<span class="go">| Boris    |</span>
<span class="go">| Cindy    |</span>
<span class="go">| Devinder |</span>
<span class="go">+----------+</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_CALLED</span><span class="o">.</span><span class="n">remove</span><span class="p">([</span><span class="s">&#39;Name&#39;</span><span class="p">])</span>
<span class="go">+-----------+</span>
<span class="go">| StudentId |</span>
<span class="go">+===========+</span>
<span class="go">| S1        |</span>
<span class="go">| S2        |</span>
<span class="go">| S3        |</span>
<span class="go">| S4        |</span>
<span class="go">| S5        |</span>
<span class="go">+-----------+</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_CALLED</span><span class="o">.</span><span class="n">remove</span><span class="p">([</span><span class="s">&#39;Name&#39;</span><span class="p">,</span> <span class="s">&#39;StudentId&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="n">IS_CALLED</span><span class="o">.</span><span class="n">project</span><span class="p">([])</span> <span class="o">==</span> <span class="n">IS_CALLED</span><span class="p">([])</span> <span class="o">==</span>  <span class="n">DEE</span>
<span class="go">True</span>
</pre></div>
</div>
<div class="section" id="rename-rename">
<h2><a class="toc-backref" href="#id37">Rename (rename)</a></h2>
<p>This is crucial to our implementation since attributes with the same name are considered to represent the same thing. The mapping of old to new attribute name(s) is given as a <a class="reference external" href="http://www.python.org/">Python</a> dictionary (or indeed a Tuple would also do).</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_CALLED</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s">&#39;Name&#39;</span><span class="p">:</span><span class="s">&#39;NewName&#39;</span><span class="p">})</span>
<span class="go">+-----------+----------+</span>
<span class="go">| StudentId | NewName  |</span>
<span class="go">+===========+----------+</span>
<span class="go">| S1        | Anne     |</span>
<span class="go">| S2        | Boris    |</span>
<span class="go">| S3        | Cindy    |</span>
<span class="go">| S4        | Devinder |</span>
<span class="go">| S5        | Boris    |</span>
<span class="go">+-----------+----------+</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_CALLED</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s">&#39;StudentId&#39;</span><span class="p">:</span><span class="s">&#39;NewId&#39;</span><span class="p">,</span> <span class="s">&#39;Name&#39;</span><span class="p">:</span><span class="s">&#39;NewName&#39;</span><span class="p">})</span>
<span class="go">+-------+----------+</span>
<span class="go">| NewId | NewName  |</span>
<span class="go">+=======+----------+</span>
<span class="go">| S1    | Anne     |</span>
<span class="go">| S2    | Boris    |</span>
<span class="go">| S3    | Cindy    |</span>
<span class="go">| S4    | Devinder |</span>
<span class="go">| S5    | Boris    |</span>
<span class="go">+-------+----------+</span>
</pre></div>
</div>
<div class="section" id="restriction-where">
<h2><a class="toc-backref" href="#id38">Restriction (where)</a></h2>
<p>This is also known as relational selection, but that can be confusing because of the SELECT in SQL which is actually for projection.</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_CALLED</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">StudentId</span><span class="o">==</span><span class="s">&#39;S4&#39;</span><span class="p">)</span>
<span class="go">+-----------+----------+</span>
<span class="go">| StudentId | Name     |</span>
<span class="go">+===========+==========+</span>
<span class="go">| S4        | Devinder |</span>
<span class="go">+-----------+----------+</span>
</pre></div>
</div>
<div class="section" id="natural-join-times-intersection">
<h2><a class="toc-backref" href="#id39">Natural Join, Times, Intersection (&amp;)</a></h2>
<p>If you think about it, these are all the same thing - it just depends on whether the relations have some, none, or all of their attributes in common. We implement them all using the AND relational operator using the <a class="reference external" href="http://www.python.org/">Python</a> <tt class="docutils literal"><span class="pre">&amp;</span></tt>.
Note that since a relation heading is a set of attributes, there are no duplicate attributes.</p>
<div class="section" id="natural-join-some-attributes-in-common">
<h3><a class="toc-backref" href="#id40">Natural Join - Some attributes in common</a></h3>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_CALLED</span> <span class="o">&amp;</span> <span class="n">IS_ENROLLED_ON</span>
<span class="go">+----------+-----------+----------+</span>
<span class="go">| CourseId | StudentId | Name     |</span>
<span class="go">+==========+===========+==========+</span>
<span class="go">| C1       | S1        | Anne     |</span>
<span class="go">| C2       | S1        | Anne     |</span>
<span class="go">| C1       | S2        | Boris    |</span>
<span class="go">| C3       | S3        | Cindy    |</span>
<span class="go">| C1       | S4        | Devinder |</span>
<span class="go">+----------+-----------+----------+</span>
</pre></div>
</div>
<div class="section" id="times-cartesian-join-no-attributes-in-common">
<h3><a class="toc-backref" href="#id41">Times (Cartesian Join) - No attributes in common</a></h3>
<p>Beware: this kind of join can be very large and is almost always meaningless.</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_CALLED</span> <span class="o">&amp;</span> <span class="n">COURSE</span>
<span class="go">+----------+-----------+----------+-------------+</span>
<span class="go">| CourseId | StudentId | Name     | Title       |</span>
<span class="go">+==========+===========+==========+=============+</span>
<span class="go">| C1       | S1        | Anne     | Database    |</span>
<span class="go">| C1       | S2        | Boris    | Database    |</span>
<span class="go">| C1       | S3        | Cindy    | Database    |</span>
<span class="go">| C1       | S4        | Devinder | Database    |</span>
<span class="go">| C1       | S5        | Boris    | Database    |</span>
<span class="go">| C2       | S1        | Anne     | HCI         |</span>
<span class="go">| C2       | S2        | Boris    | HCI         |</span>
<span class="go">| C2       | S3        | Cindy    | HCI         |</span>
<span class="go">| C2       | S4        | Devinder | HCI         |</span>
<span class="go">| C2       | S5        | Boris    | HCI         |</span>
<span class="go">| C3       | S1        | Anne     | Op Systems  |</span>
<span class="go">| C3       | S2        | Boris    | Op Systems  |</span>
<span class="go">| C3       | S3        | Cindy    | Op Systems  |</span>
<span class="go">| C3       | S4        | Devinder | Op Systems  |</span>
<span class="go">| C3       | S5        | Boris    | Op Systems  |</span>
<span class="go">| C4       | S1        | Anne     | Programming |</span>
<span class="go">| C4       | S2        | Boris    | Programming |</span>
<span class="go">| C4       | S3        | Cindy    | Programming |</span>
<span class="go">| C4       | S4        | Devinder | Programming |</span>
<span class="go">| C4       | S5        | Boris    | Programming |</span>
<span class="go">+----------+-----------+----------+-------------+</span>
</pre></div>
</div>
<div class="section" id="intersection-all-attributes-in-common">
<h3><a class="toc-backref" href="#id42">Intersection - All attributes in common</a></h3>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_CALLED</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="s">&#39;C&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">IS_CALLED</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span><span class="n">t</span><span class="o">.</span><span class="n">Name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="s">&#39;A&#39;</span><span class="p">)</span>
<span class="go">+-----------+-------+</span>
<span class="go">| StudentId | Name  |</span>
<span class="go">+===========+=======+</span>
<span class="go">| S2        | Boris |</span>
<span class="go">| S5        | Boris |</span>
<span class="go">+-----------+-------+</span>
</pre></div>
<p>Note that this is equivalent to:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_CALLED</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="s">&#39;C&#39;</span> <span class="ow">and</span> <span class="n">t</span><span class="o">.</span><span class="n">Name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="s">&#39;A&#39;</span><span class="p">)</span>
<span class="go">+-----------+-------+</span>
<span class="go">| StudentId | Name  |</span>
<span class="go">+===========+=======+</span>
<span class="go">| S2        | Boris |</span>
<span class="go">| S5        | Boris |</span>
<span class="go">+-----------+-------+</span>
</pre></div>
</div>
</div>
<div class="section" id="or-union">
<h2><a class="toc-backref" href="#id43">Or, Union (|)</a></h2>
<p>These are the same thing - it just depends on whether the relations have any of their attributes in common. We implement them all using the OR relational operator using the <a class="reference external" href="http://www.python.org/">Python</a> |.
For pragmatic reasons, we only implement the Union operator, i.e. where the relations have all of their attributes in common. The more general Or would need to handle an infinite (impossible) number of alternatives.</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_CALLED</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="s">&#39;C&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="n">IS_CALLED</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span><span class="n">t</span><span class="o">.</span><span class="n">Name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="s">&#39;B&#39;</span><span class="p">)</span>
<span class="go">+-----------+----------+</span>
<span class="go">| StudentId | Name     |</span>
<span class="go">+===========+==========+</span>
<span class="go">| S4        | Devinder |</span>
<span class="go">| S1        | Anne     |</span>
<span class="go">+-----------+----------+</span>
</pre></div>
<p>Note that this is equivalent to:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_CALLED</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="s">&#39;C&#39;</span> <span class="ow">or</span> <span class="n">t</span><span class="o">.</span><span class="n">Name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="s">&#39;B&#39;</span><span class="p">)</span>
<span class="go">+-----------+----------+</span>
<span class="go">| StudentId | Name     |</span>
<span class="go">+===========+==========+</span>
<span class="go">| S1        | Anne     |</span>
<span class="go">| S4        | Devinder |</span>
<span class="go">+-----------+----------+</span>
</pre></div>
</div>
<div class="section" id="difference">
<h2><a class="toc-backref" href="#id44">Difference (-)</a></h2>
<p>Note that, unlike intersection and union, this is not commutative: which relation is mentioned first does make a difference (excuse the pun). It is implemented using the <tt class="docutils literal"><span class="pre">MINUS</span></tt> relational operator.</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_CALLED</span> <span class="o">-</span> <span class="n">IS_CALLED</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span><span class="n">t</span><span class="o">.</span><span class="n">Name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="s">&#39;B&#39;</span><span class="p">)</span>
<span class="go">+-----------+----------+</span>
<span class="go">| StudentId | Name     |</span>
<span class="go">+===========+==========+</span>
<span class="go">| S2        | Boris    |</span>
<span class="go">| S3        | Cindy    |</span>
<span class="go">| S4        | Devinder |</span>
<span class="go">| S5        | Boris    |</span>
<span class="go">+-----------+----------+</span>
</pre></div>
</div>
<div class="section" id="extension-extend">
<h2><a class="toc-backref" href="#id45">Extension (extend)</a></h2>
<p>This is used to add new attributes to relations. First, the list of the names of the extra attributes is passed, followed by a lambda expression returning a dictionary containing the attribute values for each tuple. The values can refer to the range variable introduced by the lambda to access tuple values. It is implemented using the <tt class="docutils literal"><span class="pre">EXTEND</span></tt> relational operator which in turn is implemented using the <tt class="docutils literal"><span class="pre">AND</span></tt> relational operator (can you see how?).</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_CALLED</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s">&#39;Initial&#39;</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;Initial&#39;</span><span class="p">:</span><span class="n">t</span><span class="o">.</span><span class="n">Name</span><span class="p">[:</span><span class="mi">1</span><span class="p">]})</span>
<span class="go">+---------+-----------+----------+</span>
<span class="go">| Initial | StudentId | Name     |</span>
<span class="go">+=========+===========+==========+</span>
<span class="go">| A       | S1        | Anne     |</span>
<span class="go">| B       | S2        | Boris    |</span>
<span class="go">| C       | S3        | Cindy    |</span>
<span class="go">| D       | S4        | Devinder |</span>
<span class="go">| B       | S5        | Boris    |</span>
<span class="go">+---------+-----------+----------+</span>
</pre></div>
<p>Note that this does not modify the original relation.</p>
</div>
</div>
<div class="section" id="aggregate-operators">
<h1><a class="toc-backref" href="#id46">Aggregate Operators</a></h1>
<p>These operators take relations and return scalar values according to some lambda expression (except in the case of <tt class="docutils literal"><span class="pre">COUNT</span></tt> which simply counts the number of tuples). If the relation has a single attribute then the expression defaults to it.</p>
<div class="section" id="count-len">
<h2><a class="toc-backref" href="#id47">COUNT (len)</a></h2>
<p>The number of tuples.</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">COUNT</span><span class="p">(</span><span class="n">IS_ENROLLED_ON</span><span class="p">)</span>
<span class="go">5</span>
</pre></div>
</div>
<div class="section" id="sum">
<h2><a class="toc-backref" href="#id48">SUM</a></h2>
<p>The total.</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">SUM</span><span class="p">(</span><span class="n">EXAM_MARK</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Mark</span><span class="p">)</span>
<span class="go">342</span>
</pre></div>
</div>
<div class="section" id="avg">
<h2><a class="toc-backref" href="#id49">AVG</a></h2>
<p>The average.</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">AVG</span><span class="p">(</span><span class="n">EXAM_MARK</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Mark</span><span class="p">)</span>
<span class="go">68.4</span>
</pre></div>
</div>
<div class="section" id="min">
<h2><a class="toc-backref" href="#id50">MIN</a></h2>
<p>The minimum.</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">MIN</span><span class="p">(</span><span class="n">EXAM_MARK</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Mark</span><span class="p">)</span>
<span class="go">49</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">MIN</span><span class="p">(</span><span class="n">EXAM_MARK</span><span class="p">([</span><span class="s">&#39;Mark&#39;</span><span class="p">]))</span>
<span class="go">49</span>
</pre></div>
</div>
<div class="section" id="max">
<h2><a class="toc-backref" href="#id51">MAX</a></h2>
<p>The maximum.</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">MAX</span><span class="p">(</span><span class="n">EXAM_MARK</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Mark</span><span class="p">)</span>
<span class="go">93</span>
</pre></div>
</div>
<div class="section" id="all">
<h2><a class="toc-backref" href="#id52">ALL</a></h2>
<p>The expression in this case must return a boolean value. If all of these are True then <tt class="docutils literal"><span class="pre">ALL</span></tt> returns True, and False otherwise.</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">ALL</span><span class="p">(</span><span class="n">EXAM_MARK</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">t</span><span class="o">.</span><span class="n">Mark</span> <span class="o">&lt;=</span> <span class="mi">100</span><span class="p">)</span>
<span class="go">True</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">ALL</span><span class="p">(</span><span class="n">EXAM_MARK</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Mark</span> <span class="o">&gt;</span> <span class="mi">90</span><span class="p">)</span>
<span class="go">False</span>
</pre></div>
</div>
<div class="section" id="any">
<h2><a class="toc-backref" href="#id53">ANY</a></h2>
<p>The expression in this case must return a boolean value. If any of these are True then <tt class="docutils literal"><span class="pre">ANY</span></tt> returns True, and False otherwise.</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">EXAM_MARK_HIGH_FLAG</span> <span class="o">=</span> <span class="n">EXAM_MARK</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s">&#39;High&#39;</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;High&#39;</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Mark</span> <span class="o">&gt;</span> <span class="mi">90</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">EXAM_MARK_HIGH_FLAG</span>
<span class="go">+-------+-----------+----------+------+</span>
<span class="go">| High  | StudentId | CourseId | Mark |</span>
<span class="go">+=======+===========+==========+======+</span>
<span class="go">| False | S1        | C1       | 85   |</span>
<span class="go">| False | S1        | C2       | 49   |</span>
<span class="go">| False | S2        | C1       | 49   |</span>
<span class="go">| False | S3        | C3       | 66   |</span>
<span class="go">| True  | S4        | C1       | 93   |</span>
<span class="go">+-------+-----------+----------+------+</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">ANY</span><span class="p">(</span><span class="n">EXAM_MARK_HIGH_FLAG</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">High</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
<div class="section" id="is-empty">
<h2><a class="toc-backref" href="#id54">IS_EMPTY</a></h2>
<p>This is obviously just a shorthand for <tt class="docutils literal"><span class="pre">COUNT(r)</span> <span class="pre">==</span> <span class="pre">0</span></tt>.</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_EMPTY</span><span class="p">(</span><span class="n">IS_ENROLLED_ON</span><span class="p">)</span>
<span class="go">False</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_EMPTY</span><span class="p">(</span><span class="n">IS_ENROLLED_ON</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">StudentId</span><span class="o">==</span><span class="s">&#39;S99&#39;</span><span class="p">))</span>
<span class="go">True</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_EMPTY</span><span class="p">(</span><span class="n">DUM</span><span class="p">)</span>
<span class="go">True</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_EMPTY</span><span class="p">(</span><span class="n">DEE</span><span class="p">)</span>
<span class="go">False</span>
</pre></div>
</div>
</div>
<div class="section" id="some-not-so-basic-but-very-useful-operators">
<h1><a class="toc-backref" href="#id55">Some Not-so-basic but Very Useful Operators</a></h1>
<div class="section" id="generation-generate">
<h2><a class="toc-backref" href="#id56">Generation (GENERATE)</a></h2>
<p>This is a shorthand for converting a tuple into a relation, implemented by extending DEE.</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">GENERATE</span><span class="p">({</span><span class="s">&#39;x&#39;</span><span class="p">:</span><span class="mi">50</span><span class="p">,</span> <span class="s">&#39;y&#39;</span><span class="p">:</span><span class="mi">100</span><span class="p">})</span>
<span class="go">+-----+----+</span>
<span class="go">| y   | x  |</span>
<span class="go">+=====+====+</span>
<span class="go">| 100 | 50 |</span>
<span class="go">+-----+----+</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">GENERATE</span><span class="p">(</span><span class="n">Tuple</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">100</span><span class="p">))</span>
<span class="go">+-----+----+</span>
<span class="go">| y   | x  |</span>
<span class="go">+=====+====+</span>
<span class="go">| 100 | 50 |</span>
<span class="go">+-----+----+</span>
</pre></div>
</div>
<div class="section" id="divide-divide-simple">
<h2><a class="toc-backref" href="#id57">Divide (DIVIDE_SIMPLE)</a></h2>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">DIVIDE_SIMPLE</span><span class="p">(</span><span class="n">IS_CALLED</span><span class="p">,</span> <span class="n">IS_ENROLLED_ON</span><span class="p">)</span>
<span class="go">+----------+-------+</span>
<span class="go">| CourseId | Name  |</span>
<span class="go">+==========+=======+</span>
<span class="go">| C2       | Anne  |</span>
<span class="go">| C3       | Cindy |</span>
<span class="go">+----------+-------+</span>
</pre></div>
</div>
<div class="section" id="summarization-summarize">
<h2><a class="toc-backref" href="#id58">Summarization (SUMMARIZE)</a></h2>
<p>This takes two relations, the heading of the second must be a projection of the first, plus a tuple returning one or more scalar summary expressions. If we take the EXAM_MARK relation variable, which looks like:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">EXAM_MARK</span>
<span class="go">+-----------+----------+------+</span>
<span class="go">| StudentId | CourseId | Mark |</span>
<span class="go">+===========+==========+------+</span>
<span class="go">| S1        | C1       | 85   |</span>
<span class="go">| S1        | C2       | 49   |</span>
<span class="go">| S2        | C1       | 49   |</span>
<span class="go">| S3        | C3       | 66   |</span>
<span class="go">| S4        | C1       | 93   |</span>
<span class="go">+-----------+----------+------+</span>
</pre></div>
<p>We can find the maximum Mark per marked Course like this:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">SUMMARIZE</span><span class="p">(</span><span class="n">EXAM_MARK</span><span class="p">,</span> <span class="n">EXAM_MARK</span><span class="p">([</span><span class="s">&quot;CourseId&quot;</span><span class="p">]),</span> <span class="p">{</span><span class="s">&#39;TopScore&#39;</span><span class="p">:(</span><span class="n">MAX</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Mark</span><span class="p">)})</span>
<span class="go">+----------+----------+</span>
<span class="go">| CourseId | TopScore |</span>
<span class="go">+==========+==========+</span>
<span class="go">| C1       | 93       |</span>
<span class="go">| C2       | 49       |</span>
<span class="go">| C3       | 66       |</span>
<span class="go">+----------+----------+</span>
</pre></div>
<p>And we can count the marks for every course like this (note that there is an entry for the course having no marks):</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">SUMMARIZE</span><span class="p">(</span><span class="n">EXAM_MARK</span><span class="p">,</span> <span class="n">COURSE</span><span class="p">([</span><span class="s">&quot;CourseId&quot;</span><span class="p">]),</span> <span class="p">{</span><span class="s">&#39;Takers&#39;</span><span class="p">:(</span><span class="n">COUNT</span><span class="p">,</span> <span class="bp">None</span><span class="p">)})</span>
<span class="go">+----------+--------+</span>
<span class="go">| CourseId | Takers |</span>
<span class="go">+==========+========+</span>
<span class="go">| C1       | 3      |</span>
<span class="go">| C2       | 1      |</span>
<span class="go">| C3       | 1      |</span>
<span class="go">| C4       | 0      |</span>
<span class="go">+----------+--------+</span>
</pre></div>
<dl class="docutils">
<dt>Here are the summary types available:</dt>
<dd><ul class="first last simple">
<li>COUNT</li>
<li>SUM</li>
<li>AVG</li>
<li>MIN</li>
<li>MAX</li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="grouping-and-ungrouping-group-ungroup">
<h2><a class="toc-backref" href="#id59">Grouping and Ungrouping (GROUP, UNGROUP)</a></h2>
<p>This converts relations into relations with relation-valued attributes (RVAs), and vice versa.</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">GROUP</span><span class="p">(</span><span class="n">IS_CALLED</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;StudentId&#39;</span><span class="p">],</span> <span class="s">&#39;StudentIds&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">A</span>
<span class="go">+----------+---------------+</span>
<span class="go">| Name     | StudentIds    |</span>
<span class="go">+==========+===============+</span>
<span class="go">| Anne     | +-----------+ |</span>
<span class="go">|          | | StudentId | |</span>
<span class="go">|          | +===========+ |</span>
<span class="go">|          | | S1        | |</span>
<span class="go">|          | +-----------+ |</span>
<span class="go">| Boris    | +-----------+ |</span>
<span class="go">|          | | StudentId | |</span>
<span class="go">|          | +===========+ |</span>
<span class="go">|          | | S2        | |</span>
<span class="go">|          | | S5        | |</span>
<span class="go">|          | +-----------+ |</span>
<span class="go">| Cindy    | +-----------+ |</span>
<span class="go">|          | | StudentId | |</span>
<span class="go">|          | +===========+ |</span>
<span class="go">|          | | S3        | |</span>
<span class="go">|          | +-----------+ |</span>
<span class="go">| Devinder | +-----------+ |</span>
<span class="go">|          | | StudentId | |</span>
<span class="go">|          | +===========+ |</span>
<span class="go">|          | | S4        | |</span>
<span class="go">|          | +-----------+ |</span>
<span class="go">+----------+---------------+</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">B</span> <span class="o">=</span> <span class="n">UNGROUP</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="s">&#39;StudentIds&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">B</span>
<span class="go">+-----------+----------+</span>
<span class="go">| StudentId | Name     |</span>
<span class="go">+===========+==========+</span>
<span class="go">| S1        | Anne     |</span>
<span class="go">| S2        | Boris    |</span>
<span class="go">| S5        | Boris    |</span>
<span class="go">| S3        | Cindy    |</span>
<span class="go">| S4        | Devinder |</span>
<span class="go">+-----------+----------+</span>
</pre></div>
</div>
<div class="section" id="wrapping-and-unwrapping-wrap-unwrap">
<h2><a class="toc-backref" href="#id60">Wrapping and Unwrapping (WRAP, UNWRAP)</a></h2>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">WRAP</span><span class="p">(</span><span class="n">EXAM_MARK</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;CourseId&#39;</span><span class="p">,</span> <span class="s">&#39;Mark&#39;</span><span class="p">],</span> <span class="s">&#39;CourseMark&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">A</span>
<span class="go">+-------------------------------+-----------+</span>
<span class="go">| CourseMark                    | StudentId |</span>
<span class="go">+===============================+===========+</span>
<span class="go">| Tuple(CourseId=&#39;C1&#39;, Mark=85) | S1        |</span>
<span class="go">| Tuple(CourseId=&#39;C2&#39;, Mark=49) | S1        |</span>
<span class="go">| Tuple(CourseId=&#39;C1&#39;, Mark=49) | S2        |</span>
<span class="go">| Tuple(CourseId=&#39;C3&#39;, Mark=66) | S3        |</span>
<span class="go">| Tuple(CourseId=&#39;C1&#39;, Mark=93) | S4        |</span>
<span class="go">+-------------------------------+-----------+</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">UNWRAP</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="s">&#39;CourseMark&#39;</span><span class="p">)</span>
<span class="go">+----------+-----------+------+</span>
<span class="go">| CourseId | StudentId | Mark |</span>
<span class="go">+==========+===========+======+</span>
<span class="go">| C1       | S1        | 85   |</span>
<span class="go">| C2       | S1        | 49   |</span>
<span class="go">| C1       | S2        | 49   |</span>
<span class="go">| C3       | S3        | 66   |</span>
<span class="go">| C1       | S4        | 93   |</span>
<span class="go">+----------+-----------+------+</span>
</pre></div>
</div>
<div class="section" id="semijoin-semijoin-matching">
<h2><a class="toc-backref" href="#id61">Semijoin (SEMIJOIN, MATCHING)</a></h2>
<p>This joins two relations and then projects back onto the first one. It is very useful for finding just those tuples in one relation that have a counterpart in another, hence the alias <tt class="docutils literal"><span class="pre">MATCHING</span></tt>. For example, &quot;find all students who are enrolled on at least one course&quot;:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">SEMIJOIN</span><span class="p">(</span><span class="n">IS_CALLED</span><span class="p">,</span> <span class="n">IS_ENROLLED_ON</span><span class="p">)</span>
<span class="go">+-----------+----------+</span>
<span class="go">| StudentId | Name     |</span>
<span class="go">+===========+==========+</span>
<span class="go">| S1        | Anne     |</span>
<span class="go">| S2        | Boris    |</span>
<span class="go">| S3        | Cindy    |</span>
<span class="go">| S4        | Devinder |</span>
<span class="go">+-----------+----------+</span>
</pre></div>
</div>
<div class="section" id="semidifference-semiminus-not-matching">
<h2><a class="toc-backref" href="#id62">Semidifference (SEMIMINUS, NOT_MATCHING)</a></h2>
<p>For example, &quot;find students who are enrolled on no course at all&quot;:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">SEMIMINUS</span><span class="p">(</span><span class="n">IS_CALLED</span><span class="p">,</span> <span class="n">IS_ENROLLED_ON</span><span class="p">)</span>
<span class="go">+-----------+-------+</span>
<span class="go">| StudentId | Name  |</span>
<span class="go">+===========+=======+</span>
<span class="go">| S5        | Boris |</span>
<span class="go">+-----------+-------+</span>
</pre></div>
</div>
<div class="section" id="composition-compose">
<h2><a class="toc-backref" href="#id63">Composition (COMPOSE)</a></h2>
<p>This gives a handy shorthand for performing the natural join and then removing any attributes that were common to the relations.</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">COMPOSE</span><span class="p">(</span><span class="n">IS_ENROLLED_ON</span><span class="p">,</span> <span class="n">COURSE</span><span class="p">)</span>
<span class="go">+-----------+------------+</span>
<span class="go">| StudentId | Title      |</span>
<span class="go">+===========+============+</span>
<span class="go">| S1        | Database   |</span>
<span class="go">| S2        | Database   |</span>
<span class="go">| S4        | Database   |</span>
<span class="go">| S1        | HCI        |</span>
<span class="go">| S3        | Op Systems |</span>
<span class="go">+-----------+------------+</span>
</pre></div>
<p>This operator is especially attractive if we think of a relation as a function: 'calling' the function with another relation as a parameter can be achieved by performing a natural join. For example, suppose we have a function-based relation, plus, with a heading of ['x', 'y', 'z']. Suppose the tuples of this relation are all the possible ones where x + y = z. One implementation of such a function-based relation could be:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">plusfn</span><span class="p">(</span><span class="n">trx</span><span class="p">):</span>
<span class="gp">... </span>    <span class="sd">&quot;&quot;&quot;Plus (could just as well be called minus)&quot;&quot;&quot;</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="n">set</span><span class="p">([</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="s">&#39;y&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">trx</span><span class="o">.</span><span class="n">attributes</span><span class="p">())</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">set</span><span class="p">([</span><span class="s">&#39;z&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">trx</span><span class="o">.</span><span class="n">attributes</span><span class="p">()):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="p">[</span><span class="n">Tuple</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">trx</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">trx</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">trx</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">trx</span><span class="o">.</span><span class="n">y</span><span class="p">)]</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="n">set</span><span class="p">([</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="s">&#39;z&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">trx</span><span class="o">.</span><span class="n">attributes</span><span class="p">())</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">set</span><span class="p">([</span><span class="s">&#39;y&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">trx</span><span class="o">.</span><span class="n">attributes</span><span class="p">()):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="p">[</span><span class="n">Tuple</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">trx</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">trx</span><span class="o">.</span><span class="n">z</span> <span class="o">-</span> <span class="n">trx</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">trx</span><span class="o">.</span><span class="n">z</span><span class="p">)]</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="n">set</span><span class="p">([</span><span class="s">&#39;y&#39;</span><span class="p">,</span> <span class="s">&#39;z&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">trx</span><span class="o">.</span><span class="n">attributes</span><span class="p">())</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">set</span><span class="p">([</span><span class="s">&#39;x&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">trx</span><span class="o">.</span><span class="n">attributes</span><span class="p">()):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="p">[</span><span class="n">Tuple</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">trx</span><span class="o">.</span><span class="n">z</span> <span class="o">-</span> <span class="n">trx</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">trx</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">trx</span><span class="o">.</span><span class="n">z</span><span class="p">)]</span>
<span class="go">...</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="n">set</span><span class="p">([</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="s">&#39;y&#39;</span><span class="p">,</span> <span class="s">&#39;z&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">trx</span><span class="o">.</span><span class="n">attributes</span><span class="p">()):</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="n">trx</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">trx</span><span class="o">.</span><span class="n">y</span> <span class="o">==</span> <span class="n">trx</span><span class="o">.</span><span class="n">z</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">return</span> <span class="p">[</span><span class="n">Tuple</span><span class="p">()]</span>    <span class="c">#DEE, i.e. True        #todo: should really return trx(x,y,z) - no matter?</span>
<span class="gp">... </span>        <span class="k">else</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">return</span> <span class="p">[]</span>           <span class="c">#DUM, i.e. False</span>
<span class="go">...</span>
<span class="gp">... </span>    <span class="k">raise</span> <span class="n">RelationException</span><span class="p">(</span><span class="s">&quot;Plus: Infinite rows&quot;</span><span class="p">)</span> <span class="c">#no x,y or z</span>
<span class="gp">... </span>    <span class="c">#Note: we could go further and return tuples given just one attribute</span>
<span class="gp">... </span>    <span class="c">#      or indeed we could start yielding infinite combinations if no attributes are passed</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">plus</span> <span class="o">=</span> <span class="n">Relation</span><span class="p">([</span><span class="s">&quot;x&quot;</span><span class="p">,</span> <span class="s">&quot;y&quot;</span><span class="p">,</span> <span class="s">&quot;z&quot;</span><span class="p">],</span> <span class="n">plusfn</span><span class="p">)</span>
</pre></div>
<p>And it could be used to test whether an expression is valid or not: a returned tuple means True (DEE), no tuple means False (DUM).</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">GENERATE</span><span class="p">({</span><span class="s">&#39;x&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s">&#39;y&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="s">&#39;z&#39;</span><span class="p">:</span><span class="mi">7</span><span class="p">})</span> <span class="o">&amp;</span> <span class="n">plus</span>        <span class="c">#i.e. is 3 + 4 = 7?</span>
<span class="go">+---+---+---+</span>
<span class="go">| y | x | z |</span>
<span class="go">+===+===+===+</span>
<span class="go">| 4 | 3 | 7 |</span>
<span class="go">+---+---+---+</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">GENERATE</span><span class="p">({</span><span class="s">&#39;x&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="s">&#39;y&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="s">&#39;z&#39;</span><span class="p">:</span><span class="mi">7</span><span class="p">})</span> <span class="o">&amp;</span> <span class="n">plus</span>        <span class="c">#i.e. is 4 + 4 = 7?</span>
<span class="go">+---+---+---+</span>
<span class="go">| y | x | z |</span>
<span class="go">+===+===+===+</span>
<span class="go">+---+---+---+</span>
</pre></div>
<p>Also, it could be used to fill in the blank:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">GENERATE</span><span class="p">({</span><span class="s">&#39;x&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s">&#39;y&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">})</span> <span class="o">&amp;</span> <span class="n">plus</span>               <span class="c">#i.e. what&#39;s 3 + 4?</span>
<span class="go">+---+---+---+</span>
<span class="go">| y | x | z |</span>
<span class="go">+===+===+===+</span>
<span class="go">| 4 | 3 | 7 |</span>
<span class="go">+---+---+---+</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">GENERATE</span><span class="p">({</span><span class="s">&#39;z&#39;</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span> <span class="s">&#39;y&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">})</span> <span class="o">&amp;</span> <span class="n">plus</span>               <span class="c">#i.e. what&#39;s 7 - 4?</span>
<span class="go">+---+---+---+</span>
<span class="go">| y | x | z |</span>
<span class="go">+===+===+===+</span>
<span class="go">| 4 | 3 | 7 |</span>
<span class="go">+---+---+---+</span>
</pre></div>
<p>The advantages of using a natural join in this way over standard functions is that it takes and returns a relation. So multiple questions can be asked at once:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">Relation</span><span class="p">([</span><span class="s">&quot;x&quot;</span><span class="p">,</span> <span class="s">&quot;y&quot;</span><span class="p">],</span>
<span class="gp">... </span>               <span class="p">[(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
<span class="gp">... </span>                <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
<span class="gp">... </span>                <span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">23</span><span class="p">)])</span> <span class="o">&amp;</span> <span class="n">plus</span>           <span class="c">#i.e. what are 3 + 4, 7 + 8 and 11 + 23?</span>
<span class="go">+----+----+----+</span>
<span class="go">| y  | x  | z  |</span>
<span class="go">+====+====+====+</span>
<span class="go">| 4  | 3  | 7  |</span>
<span class="go">| 8  | 7  | 15 |</span>
<span class="go">| 23 | 11 | 34 |</span>
<span class="go">+----+----+----+</span>
</pre></div>
<p>And if the function-based relation had more than one result for a given tuple, e.g. square root would return -2 and +2 for 4, then it could simply return multiple results.</p>
<p>This whole approach could be made syntactically simpler using composition. Using a function-based relation as a function (or indeed a mathematical operator) could be done with <tt class="docutils literal"><span class="pre">COMPOSE(Relation([&quot;X&quot;,</span> <span class="pre">&quot;Y&quot;],</span> <span class="pre">[(3,</span> <span class="pre">4)]),</span> <span class="pre">plus)</span></tt>.</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">COMPOSE</span><span class="p">(</span><span class="n">GENERATE</span><span class="p">({</span><span class="s">&#39;x&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s">&#39;y&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">}),</span> <span class="n">plus</span><span class="p">)</span>       <span class="c">#i.e. what&#39;s 3 + 4?</span>
<span class="go">+---+</span>
<span class="go">| z |</span>
<span class="go">+===+</span>
<span class="go">| 7 |</span>
<span class="go">+---+</span>
</pre></div>
<p>This is now looking more like a call to a plus function with the <tt class="docutils literal"><span class="pre">COMPOSE</span></tt> making sure that only the new information, the result, is returned. Of course it's really still performing a natural join on two relations. We could go further and extract the result as a number.</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">COMPOSE</span><span class="p">(</span><span class="n">GENERATE</span><span class="p">({</span><span class="s">&#39;x&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s">&#39;y&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">}),</span> <span class="n">plus</span><span class="p">)</span><span class="o">.</span><span class="n">toTuple</span><span class="p">()</span><span class="o">.</span><span class="n">z</span>           <span class="c">#i.e. what&#39;s 3 + 4?</span>
<span class="go">7</span>
</pre></div>
<p>In the future, a <a class="reference external" href="http://www.python.org/">Python</a> operator may be overridden to implement <tt class="docutils literal"><span class="pre">COMPOSE</span></tt>. For example if we override <tt class="docutils literal"><span class="pre">%</span></tt> to be relational composition then we could use something like:  <tt class="docutils literal"><span class="pre">GENERATE({'x':3,</span> <span class="pre">'y':4})</span> <span class="pre">%</span> <span class="pre">plus</span></tt>.</p>
</div>
<div class="section" id="transitive-closure-tclose">
<h2><a class="toc-backref" href="#id64">Transitive Closure (TCLOSE)</a></h2>
<p>This operator is used to traverse tree-like structures, such as a bill-of-materials. It takes as input a binary relation comprising parent and child pairs and returns a relation that has all hierarchies fully expanded. For example:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">MM</span> <span class="o">=</span> <span class="n">Relation</span><span class="p">([</span><span class="s">&quot;MAJOR_P#&quot;</span><span class="p">,</span>       <span class="s">&quot;MINOR_P#&quot;</span><span class="p">],</span>
<span class="gp">... </span>             <span class="p">[{</span><span class="s">&quot;MAJOR_P#&quot;</span><span class="p">:</span><span class="s">&#39;P1&#39;</span><span class="p">,</span>  <span class="s">&quot;MINOR_P#&quot;</span><span class="p">:</span><span class="s">&#39;P2&#39;</span><span class="p">},</span>
<span class="gp">... </span>              <span class="p">{</span><span class="s">&quot;MAJOR_P#&quot;</span><span class="p">:</span><span class="s">&#39;P1&#39;</span><span class="p">,</span>  <span class="s">&quot;MINOR_P#&quot;</span><span class="p">:</span><span class="s">&#39;P3&#39;</span><span class="p">},</span>
<span class="gp">... </span>              <span class="p">{</span><span class="s">&quot;MAJOR_P#&quot;</span><span class="p">:</span><span class="s">&#39;P2&#39;</span><span class="p">,</span>  <span class="s">&quot;MINOR_P#&quot;</span><span class="p">:</span><span class="s">&#39;P3&#39;</span><span class="p">},</span>
<span class="gp">... </span>              <span class="p">{</span><span class="s">&quot;MAJOR_P#&quot;</span><span class="p">:</span><span class="s">&#39;P2&#39;</span><span class="p">,</span>  <span class="s">&quot;MINOR_P#&quot;</span><span class="p">:</span><span class="s">&#39;P4&#39;</span><span class="p">},</span>
<span class="gp">... </span>              <span class="p">{</span><span class="s">&quot;MAJOR_P#&quot;</span><span class="p">:</span><span class="s">&#39;P3&#39;</span><span class="p">,</span>  <span class="s">&quot;MINOR_P#&quot;</span><span class="p">:</span><span class="s">&#39;P5&#39;</span><span class="p">},</span>
<span class="gp">... </span>              <span class="p">{</span><span class="s">&quot;MAJOR_P#&quot;</span><span class="p">:</span><span class="s">&#39;P4&#39;</span><span class="p">,</span>  <span class="s">&quot;MINOR_P#&quot;</span><span class="p">:</span><span class="s">&#39;P6&#39;</span><span class="p">},</span>
<span class="gp">... </span>             <span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">TCLOSE</span><span class="p">(</span><span class="n">MM</span><span class="p">)</span>
<span class="go">+----------+----------+</span>
<span class="go">| MAJOR_P# | MINOR_P# |</span>
<span class="go">+==========+==========+</span>
<span class="go">| P1       | P2       |</span>
<span class="go">| P1       | P3       |</span>
<span class="go">| P2       | P3       |</span>
<span class="go">| P2       | P4       |</span>
<span class="go">| P3       | P5       |</span>
<span class="go">| P4       | P6       |</span>
<span class="go">| P1       | P4       |</span>
<span class="go">| P1       | P5       |</span>
<span class="go">| P2       | P5       |</span>
<span class="go">| P2       | P6       |</span>
<span class="go">| P1       | P6       |</span>
<span class="go">+----------+----------+</span>
</pre></div>
</div>
<div class="section" id="quota-quota">
<h2><a class="toc-backref" href="#id65">Quota (QUOTA)</a></h2>
<p>This restricts a relation to tuples with a number of values after ranking them by the given attribute(s). For example, to find the three lowest marks:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">QUOTA</span><span class="p">(</span><span class="n">EXAM_MARK</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;Mark&#39;</span><span class="p">])</span>
<span class="go">+----------+-----------+------+</span>
<span class="go">| CourseId | StudentId | Mark |</span>
<span class="go">+==========+===========+======+</span>
<span class="go">| C2       | S1        | 49   |</span>
<span class="go">| C1       | S2        | 49   |</span>
<span class="go">| C3       | S3        | 66   |</span>
<span class="go">+----------+-----------+------+</span>
</pre></div>
<p>This operator takes an optional parameter (<tt class="docutils literal"><span class="pre">asc</span></tt>) which, if set False, sorts the tuples in descending rank before the quota is taken, e.g. to find the top three marks:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">QUOTA</span><span class="p">(</span><span class="n">EXAM_MARK</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;Mark&#39;</span><span class="p">],</span> <span class="bp">False</span><span class="p">)</span>
<span class="go">+----------+-----------+------+</span>
<span class="go">| CourseId | StudentId | Mark |</span>
<span class="go">+==========+===========+======+</span>
<span class="go">| C1       | S1        | 85   |</span>
<span class="go">| C3       | S3        | 66   |</span>
<span class="go">| C1       | S4        | 93   |</span>
<span class="go">+----------+-----------+------+</span>
</pre></div>
<p>Note: this could return a higher or lower number of tuples than the desired number if there are ties or not enough values.</p>
</div>
<div class="section" id="insert-insert">
<h2><a class="toc-backref" href="#id66">Insert (insert, |=)</a></h2>
<p>To modify a relation variable, like any other variable, you assign a value to it. Since the values of relations are often large, we introduce a shorthand, insert, for adding tuples to an existing relation variable. This shorthand really just performs a UNION (|) between the original value and the given relation (so the two relations must have the same heading).</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">IS_CALLED</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Relation</span><span class="p">([</span><span class="s">&quot;StudentId&quot;</span><span class="p">,</span> <span class="s">&quot;Name&quot;</span><span class="p">],</span> <span class="p">[(</span><span class="s">&#39;S100&#39;</span><span class="p">,</span> <span class="s">&#39;New&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;S101&#39;</span><span class="p">,</span> <span class="s">&#39;New2&#39;</span><span class="p">)]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_CALLED</span>
<span class="go">+-----------+----------+</span>
<span class="go">| StudentId | Name     |</span>
<span class="go">+===========+----------+</span>
<span class="go">| S1        | Anne     |</span>
<span class="go">| S2        | Boris    |</span>
<span class="go">| S3        | Cindy    |</span>
<span class="go">| S4        | Devinder |</span>
<span class="go">| S5        | Boris    |</span>
<span class="go">| S100      | New      |</span>
<span class="go">| S101      | New2     |</span>
<span class="go">+-----------+----------+</span>
</pre></div>
<p>An alternative is to use the inplace | assignment operator, |=:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">IS_CALLED</span> <span class="o">|=</span> <span class="n">Relation</span><span class="p">([</span><span class="s">&quot;StudentId&quot;</span><span class="p">,</span> <span class="s">&quot;Name&quot;</span><span class="p">],</span> <span class="p">[(</span><span class="s">&#39;S102&#39;</span><span class="p">,</span> <span class="s">&#39;New3&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;S103&#39;</span><span class="p">,</span> <span class="s">&#39;New4&#39;</span><span class="p">)])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_CALLED</span>
<span class="go">+-----------+----------+</span>
<span class="go">| StudentId | Name     |</span>
<span class="go">+===========+----------+</span>
<span class="go">| S1        | Anne     |</span>
<span class="go">| S2        | Boris    |</span>
<span class="go">| S3        | Cindy    |</span>
<span class="go">| S4        | Devinder |</span>
<span class="go">| S5        | Boris    |</span>
<span class="go">| S100      | New      |</span>
<span class="go">| S101      | New2     |</span>
<span class="go">| S102      | New3     |</span>
<span class="go">| S103      | New4     |</span>
<span class="go">+-----------+----------+</span>
</pre></div>
<p>There is also a version that takes a single tuple:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">IS_CALLED</span> <span class="o">|=</span> <span class="n">Tuple</span><span class="p">(</span><span class="n">StudentId</span><span class="o">=</span><span class="s">&#39;S104&#39;</span><span class="p">,</span> <span class="n">Name</span><span class="o">=</span><span class="s">&#39;New5&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_CALLED</span>
<span class="go">+-----------+----------+</span>
<span class="go">| StudentId | Name     |</span>
<span class="go">+===========+----------+</span>
<span class="go">| S1        | Anne     |</span>
<span class="go">| S2        | Boris    |</span>
<span class="go">| S3        | Cindy    |</span>
<span class="go">| S4        | Devinder |</span>
<span class="go">| S5        | Boris    |</span>
<span class="go">| S100      | New      |</span>
<span class="go">| S101      | New2     |</span>
<span class="go">| S102      | New3     |</span>
<span class="go">| S103      | New4     |</span>
<span class="go">| S104      | New5     |</span>
<span class="go">+-----------+----------+</span>
</pre></div>
</div>
<div class="section" id="delete-delete">
<h2><a class="toc-backref" href="#id67">Delete (delete, -=)</a></h2>
<p>We also introduce a shorthand, delete, for removing tuples from an existing relation variable. This shorthand really just performs a MINUS (<tt class="docutils literal"><span class="pre">-</span></tt>) between the original value and the given relation (so the two relations must have the same heading).</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">IS_CALLED</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">Relation</span><span class="p">([</span><span class="s">&quot;StudentId&quot;</span><span class="p">,</span> <span class="s">&quot;Name&quot;</span><span class="p">],</span> <span class="p">[(</span><span class="s">&#39;S100&#39;</span><span class="p">,</span> <span class="s">&#39;New&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;S101&#39;</span><span class="p">,</span> <span class="s">&#39;New2&#39;</span><span class="p">)]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_CALLED</span>
<span class="go">+-----------+----------+</span>
<span class="go">| StudentId | Name     |</span>
<span class="go">+===========+----------+</span>
<span class="go">| S1        | Anne     |</span>
<span class="go">| S2        | Boris    |</span>
<span class="go">| S3        | Cindy    |</span>
<span class="go">| S4        | Devinder |</span>
<span class="go">| S5        | Boris    |</span>
<span class="go">| S102      | New3     |</span>
<span class="go">| S103      | New4     |</span>
<span class="go">| S104      | New5     |</span>
<span class="go">+-----------+----------+</span>
</pre></div>
<p>An alternative is to use the inplace <tt class="docutils literal"><span class="pre">-</span></tt> assignment operator, <tt class="docutils literal"><span class="pre">-=</span></tt>:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">IS_CALLED</span> <span class="o">-=</span> <span class="n">Relation</span><span class="p">([</span><span class="s">&quot;StudentId&quot;</span><span class="p">,</span> <span class="s">&quot;Name&quot;</span><span class="p">],</span> <span class="p">[(</span><span class="s">&#39;S102&#39;</span><span class="p">,</span> <span class="s">&#39;New3&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;S103&#39;</span><span class="p">,</span> <span class="s">&#39;New4&#39;</span><span class="p">)])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_CALLED</span>
<span class="go">+-----------+----------+</span>
<span class="go">| StudentId | Name     |</span>
<span class="go">+===========+----------+</span>
<span class="go">| S1        | Anne     |</span>
<span class="go">| S2        | Boris    |</span>
<span class="go">| S3        | Cindy    |</span>
<span class="go">| S4        | Devinder |</span>
<span class="go">| S5        | Boris    |</span>
<span class="go">| S104      | New5     |</span>
<span class="go">+-----------+----------+</span>
</pre></div>
<p>There is also a version that takes a single tuple:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">IS_CALLED</span> <span class="o">-=</span> <span class="n">Tuple</span><span class="p">(</span><span class="n">StudentId</span><span class="o">=</span><span class="s">&#39;S104&#39;</span><span class="p">,</span> <span class="n">Name</span><span class="o">=</span><span class="s">&#39;New5&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">IS_CALLED</span>
<span class="go">+-----------+----------+</span>
<span class="go">| StudentId | Name     |</span>
<span class="go">+===========+----------+</span>
<span class="go">| S1        | Anne     |</span>
<span class="go">| S2        | Boris    |</span>
<span class="go">| S3        | Cindy    |</span>
<span class="go">| S4        | Devinder |</span>
<span class="go">| S5        | Boris    |</span>
<span class="go">+-----------+----------+</span>
</pre></div>
<p>To delete all tuples, pass itself:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">EXAM_MARK_HIGH_FLAG</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">EXAM_MARK_HIGH_FLAG</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">EXAM_MARK_HIGH_FLAG</span>
<span class="go">+------+-----------+----------+------+</span>
<span class="go">| High | StudentId | CourseId | Mark |</span>
<span class="go">+======+===========+==========+======+</span>
<span class="go">+------+-----------+----------+------+</span>
</pre></div>
<p>And to destroy the relation variable altogether, use the standard Python <tt class="docutils literal"><span class="pre">del()</span></tt> method:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">del</span><span class="p">(</span><span class="n">EXAM_MARK_HIGH_FLAG</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">EXAM_MARK_HIGH_FLAG</span>
<span class="gt">Traceback (most recent call last):</span>
        <span class="o">...</span>
<span class="nc">NameError</span>: <span class="n-Identifier">name &#39;EXAM_MARK_HIGH_FLAG&#39; is not defined</span>
</pre></div>
</div>
<div class="section" id="update-update">
<h2><a class="toc-backref" href="#id68">Update (update)</a></h2>
<p>Another shorthand, update, is for updating selected tuples in an existing relation variable. This shorthand really just performs a delete followed by an insert, with some special copying between the deleted tuples and the inserted tuples. For example, if we want to update all exam marks below 70 to 0:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">EXAM_MARK</span>
<span class="go">+-----------+----------+------+</span>
<span class="go">| StudentId | CourseId | Mark |</span>
<span class="go">+===========+==========+------+</span>
<span class="go">| S1        | C1       | 85   |</span>
<span class="go">| S1        | C2       | 49   |</span>
<span class="go">| S2        | C1       | 49   |</span>
<span class="go">| S3        | C3       | 66   |</span>
<span class="go">| S4        | C1       | 93   |</span>
<span class="go">+-----------+----------+------+</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">EXAM_MARK</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Mark</span> <span class="o">&lt;</span> <span class="mi">70</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;Mark&#39;</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">u</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;Mark&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">EXAM_MARK</span>
<span class="go">+-----------+----------+------+</span>
<span class="go">| StudentId | CourseId | Mark |</span>
<span class="go">+===========+==========+------+</span>
<span class="go">| S1        | C1       | 85   |</span>
<span class="go">| S4        | C1       | 93   |</span>
<span class="go">| S1        | C2       | 0    |</span>
<span class="go">| S2        | C1       | 0    |</span>
<span class="go">| S3        | C3       | 0    |</span>
<span class="go">+-----------+----------+------+</span>
</pre></div>
<p>The first boolean expression is used to determine which tuples to update - this is the same format used in Restriction (the where method). Then comes the list of attributes to be updated, followed by another lambda expression that returns a dictionary containing the new values for each attribute - this is the same format used in Extension (the extend method). The values here can refer to the pre-update tuple values by prefixing their names with '_OLD_', for example to remove 10 from each Mark over 9:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">EXAM_MARK</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Mark</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;Mark&#39;</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">u</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;Mark&#39;</span><span class="p">:</span><span class="n">u</span><span class="o">.</span><span class="n">_OLD_Mark</span> <span class="o">-</span> <span class="mi">10</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">EXAM_MARK</span>
<span class="go">+-----------+----------+------+</span>
<span class="go">| StudentId | CourseId | Mark |</span>
<span class="go">+===========+==========+------+</span>
<span class="go">| S1        | C2       | 0    |</span>
<span class="go">| S2        | C1       | 0    |</span>
<span class="go">| S3        | C3       | 0    |</span>
<span class="go">| S1        | C1       | 75   |</span>
<span class="go">| S4        | C1       | 83   |</span>
<span class="go">+-----------+----------+------+</span>
</pre></div>
</div>
</div>
<div class="section" id="user-definable-operators">
<h1><a class="toc-backref" href="#id69">User-definable Operators</a></h1>
<p>One of the features of <a class="reference external" href="http://www.quicksort.co.uk">Dee</a> is that adding new relational operators is easy and encouraged. Simply define a standard <a class="reference external" href="http://www.python.org/">Python</a> function taking and returning relations. For example, the transitive closure operator <tt class="docutils literal"><span class="pre">TCLOSE</span></tt>, used to explode a tree structure and discussed earlier, is implemented like this:</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">TCLOSE</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Transitive closure (an example of a recursive relational operator)&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">heading</span><span class="p">())</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">RelationInvalidOperationException</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="s">&quot;TCLOSE expects a binary relation, e.g. with a heading [&#39;X&#39;, &#39;Y&#39;]&quot;</span><span class="p">)</span>

    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">heading</span><span class="p">()</span>

    <span class="n">TTT</span> <span class="o">=</span> <span class="n">r</span> <span class="o">|</span> <span class="p">(</span><span class="n">COMPOSE</span><span class="p">(</span> <span class="n">r</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="n">Y</span><span class="p">:</span><span class="s">&#39;_Z&#39;</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span><span class="n">Y</span><span class="p">})</span> <span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s">&#39;_Z&#39;</span><span class="p">:</span><span class="n">Y</span><span class="p">}))</span>
    <span class="k">if</span> <span class="n">TTT</span> <span class="o">==</span> <span class="n">r</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">TTT</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">TCLOSE</span><span class="p">(</span><span class="n">TTT</span><span class="p">)</span>
</pre></div>
<p>Notice that this takes a single relation, asserts that it has two attributes and then recursively defines itself to return a relation. The simplicity of the definition owes much to the power of the basic relational operators, the macros defined on them, and the <a class="reference external" href="http://www.python.org/">Python</a> language itself.</p>
</div>
<div class="section" id="databases">
<h1><a class="toc-backref" href="#id70">Databases</a></h1>
<p>We currently define a base Database class (in DeeDatabase.py) which provides a namespace for grouping relation variables (base and virtual) together. It also acts as a unit of persistence for both defining, storing and loading relation variables and for transactions. Each new Database should descend from this base class. The initial base relation variable definitions and data should be added and any virtual relation variable definitions and supporting functions.</p>
<p>Each database has its own catalog: a set of relations that describe the database (including itself):</p>
<blockquote>
<ul class="simple">
<li>relations</li>
<li>attributes</li>
<li>constraints</li>
<li>constraint_attributes</li>
</ul>
</blockquote>
<p>When a database is imported, the relation variables it holds are loaded from storage. When the program that imported the database is finished, the database (i.e. all its relation variables) are stored to the storage area (e.g. disk). The database is also stored upon a transaction commit - see below.</p>
<p>The database construction method (<tt class="docutils literal"><span class="pre">__init__</span></tt> in <a class="reference external" href="http://www.python.org/">Python</a>) is called when a database is first created or loaded from storage. It is used to define initial values for relation variables, e.g.:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">darwen_Database</span><span class="p">(</span><span class="n">Database</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Define initial relvars and their initial values here</span>
<span class="sd">           (Called once on database creation)&quot;&quot;&quot;</span>
        <span class="n">Database</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="s">&#39;IS_CALLED&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Adding IS_CALLED...&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">IS_CALLED</span> <span class="o">=</span> <span class="n">Relation</span><span class="p">([</span><span class="s">&quot;StudentId&quot;</span><span class="p">,</span> <span class="s">&quot;Name&quot;</span><span class="p">],</span>
                                 <span class="p">[(</span><span class="s">&#39;S1&#39;</span><span class="p">,</span> <span class="s">&#39;Anne&#39;</span><span class="p">),</span>
                                  <span class="p">(</span><span class="s">&#39;S2&#39;</span><span class="p">,</span> <span class="s">&#39;Boris&#39;</span><span class="p">),</span>
                                  <span class="p">(</span><span class="s">&#39;S3&#39;</span><span class="p">,</span> <span class="s">&#39;Cindy&#39;</span><span class="p">),</span>
                                  <span class="p">(</span><span class="s">&#39;S4&#39;</span><span class="p">,</span> <span class="s">&#39;Devinder&#39;</span><span class="p">),</span>
                                  <span class="p">(</span><span class="s">&#39;S5&#39;</span><span class="p">,</span> <span class="s">&#39;Boris&#39;</span><span class="p">),</span>
                                 <span class="p">]</span>
                                <span class="p">)</span>
        <span class="o">...</span>
</pre></div>
<p>Also the <tt class="docutils literal"><span class="pre">_vinit</span></tt> method should be implemented to add any functions to support virtual relation variables. This is called whenever the relation variables are refreshed, e.g. after a load or rollback:</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">_vinit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Define virtual relvars/relconsts</span>
<span class="sd">    (Called repeatedly, e.g. after database load from disk or commit)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Database</span><span class="o">.</span><span class="n">_vinit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">if</span> <span class="s">&#39;C_ER&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;Defining C_ER...&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C_ER</span> <span class="o">=</span> <span class="n">Relation</span><span class="p">([</span><span class="s">&quot;CourseId&quot;</span><span class="p">,</span> <span class="s">&quot;Exam_Result&quot;</span><span class="p">],</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">vC_ER</span><span class="p">,</span>
                               <span class="p">{</span><span class="s">&#39;pk&#39;</span><span class="p">:(</span><span class="n">Key</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;CourseId&quot;</span><span class="p">])})</span>
</pre></div>
<p>And then include any supporting functions:</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">vC_ER</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">COURSE</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s">&#39;Exam_Result&#39;</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">:{</span><span class="s">&#39;Exam_Result&#39;</span><span class="p">:</span>
                                                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">EXAM_MARK</span> <span class="o">&amp;</span> <span class="n">GENERATE</span><span class="p">({</span><span class="s">&#39;CourseId&#39;</span><span class="p">:</span><span class="n">t</span><span class="o">.</span><span class="n">CourseId</span><span class="p">})</span>
                                                    <span class="p">)([</span><span class="s">&#39;StudentId&#39;</span><span class="p">,</span> <span class="s">&#39;Mark&#39;</span><span class="p">])}</span>
                            <span class="p">)([</span><span class="s">&#39;CourseId&#39;</span><span class="p">,</span> <span class="s">&#39;Exam_Result&#39;</span><span class="p">])</span> <span class="c">#fixed</span>
</pre></div>
<p>And load or create the database (this will run whenever the module is imported):</p>
<div class="highlight"><pre><span class="c">#Load or create the database</span>
<span class="n">darwen</span> <span class="o">=</span> <span class="n">Database</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">darwen_Database</span><span class="p">,</span> <span class="s">&quot;darwen&quot;</span><span class="p">)</span>
</pre></div>
<p>Then to use this database, import it:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">from</span> <span class="nn">darwen</span> <span class="k">import</span> <span class="o">*</span>
<span class="go">Defining C_ER...</span>
</pre></div>
<p>and refer to its relational variables within their namespace:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">darwen</span><span class="o">.</span><span class="n">relations</span>
<span class="go">+-----------------------+</span>
<span class="go">| relation_name         |</span>
<span class="go">+=======================+</span>
<span class="go">| IS_ENROLLED_ON        |</span>
<span class="go">| C_ER                  |</span>
<span class="go">| EXAM_MARK             |</span>
<span class="go">| IS_CALLED             |</span>
<span class="go">| relations             |</span>
<span class="go">| COURSE                |</span>
<span class="go">| constraint_attributes |</span>
<span class="go">| attributes            |</span>
<span class="go">| constraints           |</span>
<span class="go">+-----------------------+</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">COMPOSE</span><span class="p">(</span><span class="n">darwen</span><span class="o">.</span><span class="n">attributes</span><span class="p">,</span> <span class="n">GENERATE</span><span class="p">({</span><span class="s">&#39;relation_name&#39;</span><span class="p">:</span><span class="s">&#39;IS_CALLED&#39;</span><span class="p">}))</span>
<span class="go">+----------------+</span>
<span class="go">| attribute_name |</span>
<span class="go">+================+</span>
<span class="go">| StudentId      |</span>
<span class="go">| Name           |</span>
<span class="go">+----------------+</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">darwen</span><span class="o">.</span><span class="n">IS_CALLED</span>
<span class="go">+-----------+----------+</span>
<span class="go">| StudentId | Name     |</span>
<span class="go">+===========+==========+</span>
<span class="go">| S1        | Anne     |</span>
<span class="go">| S2        | Boris    |</span>
<span class="go">| S3        | Cindy    |</span>
<span class="go">| S4        | Devinder |</span>
<span class="go">| S5        | Boris    |</span>
<span class="go">+-----------+----------+</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">darwen</span><span class="o">.</span><span class="n">C_ER</span>
<span class="go">+----------+----------------------+</span>
<span class="go">| CourseId | Exam_Result          |</span>
<span class="go">+==========+----------------------+</span>
<span class="go">| C1       | +-----------+------+ |</span>
<span class="go">|          | | StudentId | Mark | |</span>
<span class="go">|          | +===========+======+ |</span>
<span class="go">|          | | S1        | 85   | |</span>
<span class="go">|          | | S2        | 49   | |</span>
<span class="go">|          | | S4        | 93   | |</span>
<span class="go">|          | +-----------+------+ |</span>
<span class="go">| C2       | +-----------+------+ |</span>
<span class="go">|          | | StudentId | Mark | |</span>
<span class="go">|          | +===========+======+ |</span>
<span class="go">|          | | S1        | 49   | |</span>
<span class="go">|          | +-----------+------+ |</span>
<span class="go">| C3       | +-----------+------+ |</span>
<span class="go">|          | | StudentId | Mark | |</span>
<span class="go">|          | +===========+======+ |</span>
<span class="go">|          | | S3        | 66   | |</span>
<span class="go">|          | +-----------+------+ |</span>
<span class="go">| C4       | +-----------+------+ |</span>
<span class="go">|          | | StudentId | Mark | |</span>
<span class="go">|          | +===========+======+ |</span>
<span class="go">|          | +-----------+------+ |</span>
<span class="go">+----------+----------------------+</span>
</pre></div>
<p>Any modifications to the existing relation variables, or new ones added to the namespace, or old ones deleted from the namespace, will be persisted when the program finishes (or after a transaction commit).</p>
</div>
<div class="section" id="clusters">
<h1><a class="toc-backref" href="#id71">Clusters</a></h1>
<p>We currently define a base Cluster class (in DeeCluster.py) which provides a namespace for grouping databases together. Each new Cluster should descend from this base class and import and set its database definitions.</p>
<p>Each cluster has its own catalog: a set of relations that describe the cluster:</p>
<blockquote>
<ul class="simple">
<li>databases</li>
</ul>
</blockquote>
<p>The cluster construction method (<tt class="docutils literal"><span class="pre">__init__</span></tt> in <a class="reference external" href="http://www.python.org/">Python</a>) is called when a cluster is first created or loaded from storage. It is used to define initial values for database variables, e.g.:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">demo_Cluster</span><span class="p">(</span><span class="n">Cluster</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Define initial databases</span>
<span class="sd">           (Called once on cluster creation)&quot;&quot;&quot;</span>
        <span class="n">Cluster</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">date</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">darwen</span> <span class="o">=</span> <span class="n">darwen</span>
</pre></div>
<p>And load or create the cluster (this will run whenever the module is imported):</p>
<div class="highlight"><pre><span class="c">#Create the cluster</span>
<span class="n">demoCluster</span> <span class="o">=</span> <span class="n">demo_Cluster</span><span class="p">(</span><span class="s">&quot;demo&quot;</span><span class="p">)</span>
</pre></div>
<p>Then to use this cluster, import it:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">from</span> <span class="nn">demoCluster</span> <span class="k">import</span> <span class="o">*</span>
</pre></div>
<p>and refer to its database variables within their namespace:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">demoCluster</span><span class="o">.</span><span class="n">databases</span>
<span class="go">+---------------+</span>
<span class="go">| database_name |</span>
<span class="go">+===============+</span>
<span class="go">| date          |</span>
<span class="go">| darwen        |</span>
<span class="go">+---------------+</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">demoCluster</span><span class="o">.</span><span class="n">darwen</span><span class="o">.</span><span class="n">relations</span>
<span class="go">+-----------------------+</span>
<span class="go">| relation_name         |</span>
<span class="go">+=======================+</span>
<span class="go">| IS_ENROLLED_ON        |</span>
<span class="go">| C_ER                  |</span>
<span class="go">| EXAM_MARK             |</span>
<span class="go">| IS_CALLED             |</span>
<span class="go">| relations             |</span>
<span class="go">| COURSE                |</span>
<span class="go">| constraint_attributes |</span>
<span class="go">| attributes            |</span>
<span class="go">| constraints           |</span>
<span class="go">+-----------------------+</span>
</pre></div>
<p>then within each database, the relation variables are available:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">demoCluster</span><span class="o">.</span><span class="n">darwen</span><span class="o">.</span><span class="n">IS_CALLED</span>
<span class="go">+-----------+----------+</span>
<span class="go">| StudentId | Name     |</span>
<span class="go">+===========+==========+</span>
<span class="go">| S1        | Anne     |</span>
<span class="go">| S2        | Boris    |</span>
<span class="go">| S3        | Cindy    |</span>
<span class="go">| S4        | Devinder |</span>
<span class="go">| S5        | Boris    |</span>
<span class="go">+-----------+----------+</span>
</pre></div>
</div>
<div class="section" id="transactions">
<h1><a class="toc-backref" href="#id72">Transactions</a></h1>
<p>These are currently controlled at the database level. The database has <tt class="docutils literal"><span class="pre">begin</span></tt>, <tt class="docutils literal"><span class="pre">commit</span></tt> and <tt class="docutils literal"><span class="pre">rollback</span></tt> methods to facilitate transactions. For example:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">darwen</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span>
<span class="go">Defining C_ER...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">try</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">darwen</span><span class="o">.</span><span class="n">EXAM_MARK</span> <span class="o">-=</span> <span class="n">darwen</span><span class="o">.</span><span class="n">EXAM_MARK</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Mark</span> <span class="o">&gt;</span> <span class="mi">80</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">darwen</span><span class="o">.</span><span class="n">EXAM_MARK</span>
<span class="gp">... </span>    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Simulated error condition&quot;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">darwen</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="gp">... </span><span class="k">except</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="s">&quot;Exception - rolling back...&quot;</span>
<span class="gp">... </span>    <span class="n">darwen</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
<span class="go">+-----------+----------+------+</span>
<span class="go">| StudentId | CourseId | Mark |</span>
<span class="go">+===========+==========+======+</span>
<span class="go">| S1        | C2       | 49   |</span>
<span class="go">| S2        | C1       | 49   |</span>
<span class="go">| S3        | C3       | 66   |</span>
<span class="go">+-----------+----------+------+</span>
<span class="go">Exception - rolling back...</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">darwen</span><span class="o">.</span><span class="n">EXAM_MARK</span>
<span class="go">+-----------+----------+------+</span>
<span class="go">| StudentId | CourseId | Mark |</span>
<span class="go">+===========+==========+======+</span>
<span class="go">| S1        | C1       | 85   |</span>
<span class="go">| S1        | C2       | 49   |</span>
<span class="go">| S2        | C1       | 49   |</span>
<span class="go">| S3        | C3       | 66   |</span>
<span class="go">| S4        | C1       | 93   |</span>
<span class="go">+-----------+----------+------+</span>
</pre></div>
</div>
<div class="section" id="front-ends">
<h1><a class="toc-backref" href="#id73">Front-ends</a></h1>
<p>As well as using the <a class="reference external" href="http://www.python.org/">Python</a> interpreter to interact with relations and databases, a stand-alone web-server that gives access to a cluster of sample databases from a browser is available. To start the server and a client run:</p>
<blockquote>
python DeeWebDemo.py</blockquote>
<p>The default browser should launch and a text box will be presented to allow <a class="reference external" href="http://www.quicksort.co.uk">Dee</a> expressions to be entered. The expression can be evaluated by pressing the 'Evaluate' button. The default database can be changed by selecting from the drop-down list and pressing the 'Change database' button.</p>
</div>
<div class="section" id="future-work">
<h1><a class="toc-backref" href="#id74">Future Work</a></h1>
<p>There are a number of areas that need more work. These include:</p>
<div class="section" id="constraint-checking">
<h2><a class="toc-backref" href="#id75">Constraint Checking</a></h2>
<p>This should be optimised for insert/update operations where often just the new tuples need to be checked. Also more work could be done to simplify and improve the declaration of some constraints, e.g. ForeignKey, and the representation and storage of ad-hoc lambda functions.</p>
<p>Currently if a constraint fails during the insertion phase of an update, the deletions are not rolled back (unless this is manually controlled via a database transaction).</p>
<p>We would also like to use a multiple assignment mechanism, similar to <a class="reference external" href="http://www.python.org/">Python</a>'s, to achieve parallel assignment to avoid any need for deferred constraints.</p>
</div>
<div class="section" id="constraint-inference">
<h2><a class="toc-backref" href="#id76">Constraint Inference</a></h2>
<p>We need to implement routines to ensure relation constraints, such as candidate keys, are inferred in derived relations. We do some of this already, e.g. for the rename operator, but much more is required.</p>
</div>
<div class="section" id="catalog-maintenance">
<h2><a class="toc-backref" href="#id77">Catalog Maintenance</a></h2>
<p>Adding and removing constraints from existing relations is not yet supported. Also database-level constraints cannot be created yet. Also actions such as deleting a relation variable that is referenced should be handled better.</p>
</div>
<div class="section" id="storage">
<h2><a class="toc-backref" href="#id78">Storage</a></h2>
<p>With memory sizes measured in Gigabytes, the immediate intention is to keep databases in memory with a protected power supply to provide short-term durability. For longer term durability, the database can be saved to disk. This is currently done by storing the database relation variables in a single <a class="reference external" href="http://www.python.org/">Python</a> pickle file. If the debug_dump constant is True in DeeDatabase then a script is also written containing the latest relation definitions and data. This storage mechanism could be made more efficient (by storing incremental changes rather than the whole database) and more resilient (e.g. storing online to Amazon's <a class="reference external" href="http://www.amazon.com/s3">S3</a>).</p>
</div>
<div class="section" id="concurrency">
<h2><a class="toc-backref" href="#id79">Concurrency</a></h2>
<p>The current implementation is intended to be shared by a single application, e.g. a web-server, feeding multiple clients. Work is needed to ensure that multiple threads can share the data and serialise transactions.</p>
</div>
<div class="section" id="attribute-values">
<h2><a class="toc-backref" href="#id80">Attribute Values</a></h2>
<p>Some work is needed to tighten up the permitted values in Tuples. For example, whether <tt class="docutils literal"><span class="pre">None</span></tt> can ever be used and how <a class="reference external" href="http://www.python.org/">Python</a> objects are stored and compared.</p>
</div>
<div class="section" id="api">
<h2><a class="toc-backref" href="#id81">API</a></h2>
<p>We envisage several possible ways of accessing the data, e.g. RPC, SOAP.</p>
</div>
<div class="section" id="virtual-relation-variables">
<h2><a class="toc-backref" href="#id82">Virtual Relation Variables</a></h2>
<p>These need to allow inserts, deletes and updates that can then be passed down to the base relation(s) where possible. Also an improved method for storing their definitions is needed.</p>
</div>
<div class="section" id="security">
<h2><a class="toc-backref" href="#id83">Security</a></h2>
<p>Access rights and privileges need to be designed and implemented.</p>
</div>
<div class="section" id="sql-veneer">
<h2><a class="toc-backref" href="#id84">SQL Veneer</a></h2>
<p>Obviously SQL will be around for a long time yet, so an interpreter could be built to parse SQL and generate the equivalent statements in <a class="reference external" href="http://www.quicksort.co.uk">Dee</a> (where possible).</p>
</div>
<div class="section" id="optimisation">
<h2><a class="toc-backref" href="#id85">Optimisation</a></h2>
<p>By working with in-memory data and using fully hashed relations we can perform very fast joins. We have some optimisation code for some relational operators, but this could be improved e.g. by introducing a ternary join operator <tt class="docutils literal"><span class="pre">AND(r,</span> <span class="pre">s,</span> <span class="pre">t)</span></tt>.</p>
<p>As another example, the <tt class="docutils literal"><span class="pre">where</span></tt> method effectively scans the relation, filtering by the given expression. For equality checks on large relations it would be much faster to use <tt class="docutils literal"><span class="pre">&amp;</span></tt> with the appropriate relation: then the hash join will be used instead of a scan. This optimisation can be made manually, e.g. replace <tt class="docutils literal"><span class="pre">r.where(lambda</span> <span class="pre">t:</span> <span class="pre">t.Name=='Find</span> <span class="pre">it')</span></tt> with <tt class="docutils literal"><span class="pre">r</span> <span class="pre">&amp;</span> <span class="pre">GENERATE({'Name':'Find</span> <span class="pre">it'})</span></tt>, but it ought to be done by the system.</p>
</div>
<div class="section" id="surface-more-abstractions">
<h2><a class="toc-backref" href="#id86">Surface More Abstractions</a></h2>
<p>Perhaps we should introduce more Relation methods (such as intersect, union, join, times) to map onto the existing operators. These would simply be aliases but may make things appear more familiar. On the other hand, once it's realised that these are all just AND and OR, it might be best to keep the number of different names for the same thing to a minimum.</p>
</div>
<div class="section" id="et-cetera">
<h2><a class="toc-backref" href="#id87">Et Cetera</a></h2>
<ul class="simple">
<li>renderXML() plus XSLT</li>
<li>Excel/web-spreadsheet as a front-end for data entry</li>
<li>_scan to yield tuples for pipelining</li>
<li>Some syntactic improvements (if not a whole interpreted layer)</li>
<li>Add to sense-checking throughout</li>
<li>Fix, test and document generic DIVIDE</li>
<li>Overload / operator for Relations to be relational DIVIDE</li>
<li>Determine extend/update attribute lists from the lambda expression's dictionary keys</li>
<li>Allow RVAs to be described in the catalog (i.e. recursive catalog)</li>
<li>Put into a Python package</li>
<li>Syntax highlighting</li>
</ul>
</div>
</div>
<div class="section" id="colophon">
<h1><a class="toc-backref" href="#id88">Colophon</a></h1>
<p>This document was written in <a class="reference external" href="http://docutils.sourceforge.net/rst.html">reStructuredText</a> format. The HTML was generated using <a class="reference external" href="http://docutils.sourceforge.net/">Docutils</a> and the syntax highlighting was handled by <a class="reference external" href="http://pygments.org/">Pygments</a>. The examples within it were verified by <a class="reference external" href="http://www.python.org/doc/lib/module-doctest.html">doctest</a>.</p>
<table class="docutils footnote" frame="void" id="id4" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[1]</a></td><td>&quot;Date and Darwen's Database Dream&quot;</td></tr>
</tbody>
</table>
</div>
</div>
<div class="footer">
<hr class="footer" />
Generated on: 2007-05-25 08:27 UTC.

</div>
</body>
</html>
